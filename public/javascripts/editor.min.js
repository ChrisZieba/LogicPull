/*! LogicPull 0.9.8 2015-11-29 */
var Editor=Editor||{};Editor.debug=function(){"use strict";var a=null,b=function(){var b=Editor.socket.getSocket();b.on("question",function(b){Editor.debug.addData(b.data.debug),a=b.qid})};return{init:function(){b()},getActiveQuestion:function(){return a},setActiveQuestion:function(b){a=b},buildDebug:function(){Editor.thumbnail.hideThumbnail(),$("#debug").html("")},showDebug:function(){$("#debug").removeClass("none")},hideDebug:function(){$("#debug").addClass("none")},addData:function(a){var b=$("#debug");b.append(a),b.scrollTop(b.get(0).scrollHeight)}}}();var Editor=Editor||{};Editor.details=Editor.details||{},Editor.details.contents=Editor.details.contents||{},Editor.details.contents.advanced=function(){"use strict";var a=null,b=null,c=function(){$(".advanced-item").live("click",function(){var b=Editor.main.getCurrentQuestion(),c=$(this).data("advanced-index");c!==a&&(null!==a&&$("#ca-list").find("[data-advanced-index='"+a+"']").removeClass("active"),a=c,$(this).addClass("active"),$("#advanced-item").html(m(questions[b].advanced[c],c)))}),$(".action-advanced-value").live("click",function(){var c,d=Editor.main.getCurrentQuestion();null!==b&&$("#advanced-actions-list").find("[data-action-item-index='"+b+"']").removeClass("active"),c=$(this).data("action-item-index"),b=c,$(this).addClass("active"),$("#advanced-action-block").html(g(questions[d].advanced[a].actions[b],b)),Editor.thumbnail.buildThumbnail(d)}),$("#advanced-event-dd").live("change",function(){var b=Editor.main.getCurrentQuestion(),c=$(this).val();questions[b].advanced[a].event=c;var e=$("#ca-list");e.html(d(questions[b].advanced)),e.find("[data-advanced-index='"+a+"']").addClass("active"),Editor.thumbnail.buildThumbnail(b)}),$("#action-goto-destination-dd").live("change",function(){var c=Editor.main.getCurrentQuestion(),d=questions[c].advanced[a].actions[b].value,e=$(this).val(),f=c,g=$(this).data("action-goto-pid");Editor.graph.changePathDestination(g,f,e,d),questions[c].advanced[a].actions[b].value=e,Editor.thumbnail.buildThumbnail(c)}),$(".caia").live("click",function(){var b,c,e,f,g,h,i=Editor.main.getCurrentQuestion(),j=$(this).data("button-cmd");if("add"===j)c=$("#ca-list"),a=questions[i].advanced.push({event:"after",condition:"true",actions:[{"if":!0,action:"goto",name:null,value:"none",pid:null}]})-1,c.html(d(questions[i].advanced)),c.find("[data-advanced-index='"+a+"']").addClass("active"),$("#advanced-item").html(m(questions[i].advanced[a],a));else if("remove"===j){if(null!==a){for(e=questions[i].advanced[a].actions,b=0;b<e.length;b+=1)e[b]&&(f=e[b].pid,f&&Editor.graph.deletePath(i,f));g=questions[i].advanced,delete questions[i].advanced[a],a=null,questions[i].advanced=Editor.utils.rebuildArray(g),$("#ca-list").html(d(questions[i].advanced)),$("#advanced-item").html("")}}else"up"===j?null!==a&&0!==a&&(g=questions[i].advanced[a],c=$("#ca-list"),b=1,questions[i].advanced[a]=questions[i].advanced[a-b],questions[i].advanced[a-b]=g,c.html(d(questions[i].advanced)),a-=b,c.find("[data-advanced-index='"+a+"']").addClass("active")):"down"===j&&(h=questions[i].advanced.length-1,null!==a&&a!==h&&(g=questions[i].advanced[a],c=$("#ca-list"),b=1,questions[i].advanced[a]=questions[i].advanced[a+b],questions[i].advanced[a+b]=g,c.html(d(questions[i].advanced)),a+=b,c.find("[data-advanced-index='"+a+"']").addClass("active")));Editor.thumbnail.buildThumbnail(i)}),$(".caaia").live("click",function(){var c,d,e,f,h,i,j,l=Editor.main.getCurrentQuestion(),m=$(this).data("a-advanced-cmd");"add"===m?(c=$("#advanced-actions-list"),d=$("#advanced-item"),e={"if":!0,action:"goto",name:null,value:"none",pid:null},b=questions[l].advanced[a].actions.push(e)-1,c.html(k(questions[l].advanced[a].actions)),c.find("[data-action-item-index='"+b+"']").addClass("active"),$("#advanced-action-block").html(g(questions[l].advanced[a].actions[b],b))):"remove"===m?null!==b&&(c=$("#advanced-actions-list"),f=questions[l].advanced[a].actions,h=questions[l].advanced[a].actions[b].pid,delete questions[l].advanced[a].actions[b],questions[l].advanced[a].actions=Editor.utils.rebuildArray(f),b=null,c.html(k(questions[l].advanced[a].actions)),$("#advanced-action-block").html(""),h&&Editor.graph.deletePath(l,h)):"up"===m?null!==b&&0!==b&&(f=questions[l].advanced[a].actions[b],c=$("#advanced-actions-list"),i=1,questions[l].advanced[a].actions[b]=questions[l].advanced[a].actions[b-i],questions[l].advanced[a].actions[b-i]=f,c.html(k(questions[l].advanced[a].actions)),b-=i,c.find("[data-action-item-index='"+b+"']").addClass("active")):"down"===m&&(j=questions[l].advanced[a].actions.length-1,null!==b&&b!==j&&(f=questions[l].advanced[a].actions[b],c=$("#advanced-actions-list"),i=1,questions[l].advanced[a].actions[b]=questions[l].advanced[a].actions[b+i],questions[l].advanced[a].actions[b+i]=f,c.html(k(questions[l].advanced[a].actions)),b+=i,c.find("[data-action-item-index='"+b+"']").addClass("active"))),Editor.thumbnail.buildThumbnail(l)}),$("#advanced-condition-textarea").live("change",function(b){var c,e=$(this).val().trim(),f=Editor.main.getCurrentQuestion();Editor.validation.check(e,["condition"])?(questions[f].advanced[a].condition=e,$(this).val(e),c=$("#ca-list"),c.html(d(questions[f].advanced)),c.find("[data-advanced-index='"+a+"']").addClass("active")):($(this).val(questions[f].advanced[a].condition),alert("This field is required."),b.preventDefault()),Editor.thumbnail.buildThumbnail(f)}),$("#advanced-action-value-textarea").live("change",function(){var c,d=$(this).val().trim(),e=Editor.main.getCurrentQuestion();questions[e].advanced[a].actions[b].value=d,$(this).val(d),c=$("#advanced-actions-list"),c.html(k(questions[e].advanced[a].actions)),c.find("[data-action-item-index='"+b+"']").addClass("active"),Editor.thumbnail.buildThumbnail(e)}),$(".advanced-action-dd").live("change",function(){var c,d,e,f,g,l,m=$(this).val(),n=$(this).data("advanced-action-dd"),o=Editor.main.getCurrentQuestion();switch(n){case"if":c="true"===m?!0:!1,questions[o].advanced[a].actions[b]["if"]=c;break;case"action":"set"===m?(d=questions[o].advanced[a].actions[b].pid,d&&Editor.graph.deletePath(o,d),questions[o].advanced[a].actions[b].name=o+"_",questions[o].advanced[a].actions[b].value="",questions[o].advanced[a].actions[b].pid=null,$("#advanced-action-action").html(i(questions[o].advanced[a].actions[b].name)),$("#advanced-action-value").html(j(questions[o].advanced[a].actions[b].value))):(questions[o].advanced[a].actions[b].name=null,questions[o].advanced[a].actions[b].value="none",questions[o].advanced[a].actions[b].pid=null,$("#advanced-action-action").html(h(o,questions[o].advanced[a].actions[b])),$("#advanced-action-value").html("")),questions[o].advanced[a].actions[b].action=m;break;case"value":d=questions[o].advanced[a].actions[b].pid,e=questions[o].advanced[a].actions[b].value,"none"!==m?d?(questions[o].advanced[a].actions[b].value=m,Editor.graph.changePathDestination(d,o,m,e)):(f={s:o,d:m,stroke:"#A2122F",stroke_width:"3"},g=Editor.graph.addPath(f),questions[o].advanced[a].actions[b].value=m,questions[o].advanced[a].actions[b].pid=g):(Editor.graph.deletePath(o,d),questions[o].advanced[a].actions[b].value="none",questions[o].advanced[a].actions[b].pid=null)}l=$("#advanced-actions-list"),l.html(k(questions[o].advanced[a].actions)),l.find("[data-action-item-index='"+b+"']").addClass("active"),Editor.thumbnail.buildThumbnail(o)}),$(".action-name-textbox").live("change",function(c){var d,e=$(this).val().trim(),f=Editor.main.getCurrentQuestion();Editor.validation.check(e,["variable"])?(questions[f].advanced[a].actions[b].name=e,$(this).val(e),d=$("#advanced-actions-list"),d.html(k(questions[f].advanced[a].actions)),d.find("[data-action-item-index='"+b+"']").addClass("active")):($(this).val(questions[f].advanced[a].actions[b].name),alert("action name value"),c.preventDefault()),Editor.thumbnail.buildThumbnail(f)})},d=function(a){var b=[];b.push("<ul>");for(var c=0;c<a.length;c+=1)a[c]&&(b.push('<li data-advanced-index="'+c+'" class="advanced-item">'),b.push('<span class="bold">['+a[c].event+"] </span>"),b.push(a[c].condition?"<span>"+a[c].condition+"</span>":"<span>null</span>"),b.push("</li>"));return b.push("</ul>"),b.join("")},e=function(a){var b=[],c=["before","after"];b.push('<div class="advanced-property">'),b.push('<div class="b-label">Event: </div>'),b.push('<select class="large-dropdown" id="advanced-event-dd">');for(var d=0;d<c.length;d+=1)b.push(c[d]===a?'<option selected="selected">'+c[d]+"</option>":"<option>"+c[d]+"</option>");return b.push("</select>"),b.push("</div>"),b.join("")},f=function(a){var b=[];return b.push('<div class="advanced-property">'),b.push('<div class="b-label">Condition: </div>'),b.push('<textarea id="advanced-condition-textarea" class="text-area-def">'+a+"</textarea>"),b.push("</div>"),b.join("")},g=function(a){var b,c=[],d=Editor.main.getCurrentQuestion(),e=["true","false"],f=["set","goto"];c.push('<div class="advanced-action-value-property">'),c.push('<div class="e-label">IF: </div>'),c.push('<div class="advanced-action-d-container">'),c.push('<select class="fair-dropdown advanced-action-dd" data-advanced-action-dd="if">');for(var g=0;g<e.length;g+=1)b="true"===e[g],c.push(b===a["if"]?'<option selected="selected">'+e[g]+"</option>":"<option>"+e[g]+"</option>");c.push("</select>"),c.push("</div>"),c.push('<div class="advanced-action-d-container">'),c.push('<select class="fair-dropdown advanced-action-dd" data-advanced-action-dd="action">');for(var k=0;k<f.length;k+=1)c.push(f[k]===a.action?'<option selected="selected">'+f[k]+"</option>":"<option>"+f[k]+"</option>");return c.push("</select>"),c.push("</div>"),"goto"===a.action?(c.push('<div class="advanced-action-e-container" id="advanced-action-action">'),c.push(h(d,a)),c.push("</div>"),c.push("</div>"),c.push('<div id="advanced-action-value"></div>')):(c.push('<div class="advanced-action-e-container" id="advanced-action-action">'),c.push(i(a.name)),c.push("</div>"),c.push("</div>"),c.push('<div id="advanced-action-value">'),c.push(j(a.value)),c.push("</div>")),c.join("")},h=function(a,b){var c=[];a=Editor.main.getCurrentQuestion(),c.push('<select class="medium-dropdown advanced-action-dd" data-advanced-action-dd="value"><option>none</option>');for(var d in questions)questions.hasOwnProperty(d)&&questions[d].qid!==a&&c.push(questions[d].qid===b.value?'<option selected="selected">'+questions[d].qid+"</option>":"<option>"+questions[d].qid+"</option>");return c.push("</select>"),c.join("")},i=function(a){var b=[];return b.push('<input type="text" class="ah action-name-textbox" value="'+a+'" />'),b.join("")},j=function(a){var b=[];return b.push('<textarea id="advanced-action-value-textarea" class="text-area-def-2">'+a+"</textarea>"),b.join("")},k=function(a){for(var b=[],c=0;c<a.length;c+=1)a[c]&&b.push("goto"===a[c].action?'<div data-action-item-index="'+c+'" class="action-advanced-value">IF <span class="bold">'+a[c]["if"]+'</span> <span class="uppercase">'+a[c].action+'</span> <span class="bold">'+a[c].value+"</span></div>":'<div data-action-item-index="'+c+'" class="action-advanced-value">IF <span class="bold">'+a[c]["if"]+'</span> <span class="uppercase">'+a[c].action+'</span> <span class="bold">'+a[c].name+'</span> TO <span class="bold">'+a[c].value+"</span></div>");return b.join("")},l=function(a){var b=[];return b.push('<div class="clear"></div>'),b.push('<div class="c-label">Actions: </div>'),b.push('<div class="advanced-actions-list-container">'),b.push('<div id="advanced-actions-list">'),b.push(k(a)),b.push("</div>"),b.push('<ul class="ca-a-list-controls">'),b.push('<li data-a-advanced-cmd="add" class="add unselectable caaia">Add</li>'),b.push('<li data-a-advanced-cmd="up" class="up unselectable caaia">Up</li>'),b.push('<li data-a-advanced-cmd="down" class="down unselectable caaia">Down</li>'),b.push('<li data-a-advanced-cmd="remove" class="remove unselectable caaia">Remove</li>'),b.push("</ul>"),b.push('<div id="advanced-action-block"></div>'),b.push("</div>"),b.join("")},m=function(a,b){var c=[];return c.push(e(a.event,b)),c.push(f(a.condition,b)),c.push(l(a.actions,b)),c.join("")};return{init:function(){c()},buildAdvanced:function(a){$("#ca-list").html(d(questions[a].advanced))},emptyAdvanced:function(){a=null,b=null,$("#advanced-item").html(""),$("#ca-list").html("")},removeOldRefs:function(a,b){for(var c=0;c<questions[a].advanced.length;c+=1)if(null!==questions[a].advanced[c].actions&&"undefined"!=typeof questions[a].advanced[c].actions)for(var d=0;d<questions[a].advanced[c].actions.length;d+=1)"goto"===questions[a].advanced[c].actions[d].action&&questions[a].advanced[c].actions[d].value===b&&(questions[a].advanced[c].actions[d].value="none",questions[a].advanced[c].actions[d].pid=null)}}}();var Editor=Editor||{};Editor.details=Editor.details||{},Editor.details.contents=Editor.details.contents||{},Editor.details.contents.buttons=function(){"use strict";var a=null,b=function(){$(".button-item").live("click",function(){var b=Editor.main.getCurrentQuestion();null!==a&&$("#cb-list").find("[data-button-index='"+a+"']").removeClass("active");var d=$(this).data("button-index");a=d,$(this).addClass("active"),$("#button-item").html(c(b,questions[b].buttons[d],d))}),$(".cbia").live("click",function(){var b,e,f,g,h,i,j=Editor.main.getCurrentQuestion(),k=$(this).data("button-cmd");"add"===k?(b=$("#cb-list"),i=$("#button-item"),a=questions[j].buttons.push({type:"continue",destination:"none",pid:null})-1,b.html(d(questions[j].buttons)),b.find("[data-button-index='"+a+"']").addClass("active"),i.html(c(j,questions[j].buttons[a],a))):"remove"===k?null!==a&&(e=questions[j].buttons[a].pid,f=questions[j].buttons,delete questions[j].buttons[a],a=null,questions[j].buttons=Editor.utils.rebuildArray(f),$("#cb-list").html(d(questions[j].buttons)),$("#button-item").html(""),e&&Editor.graph.deletePath(j,e)):"up"===k?null!==a&&0!==a&&(f=questions[j].buttons[a],b=$("#cb-list"),g=1,questions[j].buttons[a]=questions[j].buttons[a-g],questions[j].buttons[a-g]=f,$("#cb-list").html(d(questions[j].buttons)),a-=g,b.find("[data-button-index='"+a+"']").addClass("active")):"down"===k&&(h=questions[j].buttons.length-1,null!==a&&a!==h&&(f=questions[j].buttons[a],b=$("#cb-list"),g=1,questions[j].buttons[a]=questions[j].buttons[a+g],questions[j].buttons[a+g]=f,b.html(d(questions[j].buttons)),a+=g,b.find("[data-button-index='"+a+"']").addClass("active")))}),$("#button-type-dd").live("change",function(){var b=Editor.main.getCurrentQuestion(),c=$(this).val();questions[b].buttons[a].type=c,questions[b].buttons[a].destination="none",questions[b].buttons[a].pid=null;var e=$("#cb-list");e.html(d(questions[b].buttons)),e.find("[data-button-index='"+a+"']").addClass("active"),Editor.thumbnail.buildThumbnail(b)}),$("#button-destination-dd").live("change",function(){var b,c,d=Editor.main.getCurrentQuestion(),e=questions[d].buttons[a].destination,f=$(this).val(),g=d,h=questions[d].buttons[a].pid;"none"!==f?h?(Editor.graph.changePathDestination(h,g,f,e),questions[d].buttons[a].destination=f):(c={s:g,d:f,stroke:"#FF9900",stroke_width:"3"},b=Editor.graph.addPath(c),questions[d].buttons[a].destination=f,questions[d].buttons[a].pid=b):(Editor.graph.deletePath(d,h),questions[d].buttons[a].destination="none",questions[d].buttons[a].pid=null)}),$(".button-textbox").live("change",function(b){var c=$(this).val().trim(),d=Editor.main.getCurrentQuestion(),e=$(this).data("button-textbox-id");switch(e){case"label":Editor.validation.check(c,["label"])?(questions[d].buttons[a].text=c,$(this).val(c)):($(this).val(questions[d].buttons[a].text),alert("Only letters and numbers are allowed."),b.preventDefault())}Editor.thumbnail.buildThumbnail(d)})},c=function(a,b){var c=[],d=["continue","exit","finish"];b.text||(b.text=""),c.push('<div class="button-property">'),c.push('<div class="b-label">Type: </div>'),c.push('<select class="large-dropdown" id="button-type-dd">');for(var e=0;e<d.length;e+=1)c.push(d[e]===b.type?'<option selected="selected">'+d[e]+"</option>":"<option>"+d[e]+"</option>");c.push("</select>"),c.push("</div>"),c.push('<div class="clear"></div>'),c.push('<div class="field-property">'),c.push('<div class="b-label">Destination: </div>'),c.push('<select class="large-dropdown" id="button-destination-dd"><option>none</option>');for(var f in questions)questions.hasOwnProperty(f)&&questions[f].qid!==a&&c.push(questions[f].qid===b.destination?'<option selected="selected">'+questions[f].qid+"</option>":"<option>"+questions[f].qid+"</option>");return c.push("</select>"),c.push("</div>"),c.push('<div class="clear"></div>'),c.push('<div class="field-property">'),c.push('<div class="b-label">Text: </div>'),c.push('<input type="text" value="'+b.text+'" class="button-textbox ac" data-button-textbox-id="label">'),c.push("</div>"),c.join("")},d=function(a){var b=[];if(a){b.push("<ul>");for(var c=0;c<a.length;c+=1)a[c]&&(b.push('<li data-button-index="'+c+'" class="button-item">'),b.push("<span>"+a[c].type+" </span>"),b.push("</li>"));b.push("</ul>")}return b.join("")};return{init:function(){b()},buildButtons:function(a){$("#cb-list").html(d(questions[a].buttons))},emptyButtons:function(){a=null,$("#button-item").html(""),$("#cb-list").html("")},removeOldRefs:function(a,b){for(var c=0;c<questions[a].buttons.length;c+=1)questions[a].buttons[c].destination===b&&(questions[a].buttons[c].destination="none",questions[a].buttons[c].pid=null)}}}();var Editor=Editor||{};Editor.details=Editor.details||{},Editor.details.contents=Editor.details.contents||{},Editor.details.contents.fields=Editor.details.contents.fields||{},Editor.details.contents.fields.checkbox=function(){"use strict";var a=null,b=function(){$(".checkbox-field-value").live("click",function(){var b=Editor.main.getCurrentQuestion();null!==a&&$("#checkbox-field-values").find("[data-checkbox-item-index='"+a+"']").removeClass("active");var d=Editor.details.contents.fields.common.getActiveField(),e=$(this).data("checkbox-item-index");a=e,$(this).addClass("active"),$("#checkbox-field-block").html(c(questions[b].fields[d].values[a]))}),$(".checkbox-field-textbox").live("change",function(b){var c,e,f=$(this).val().trim(),g=Editor.main.getCurrentQuestion(),h=Editor.details.contents.fields.common.getActiveField(),i=$(this).data("field-textbox-id");switch(i){case"checkbox_id":c=Editor.details.contents.fields.checkbox.getActiveCheckboxField(),Editor.validation.check(f,["required","variable"])?(questions[g].fields[h].values[c].id=f,$(this).val(f)):($(this).val(questions[g].fields[h].values[c].id),alert("Did not pass validation."),b.preventDefault());break;case"checkbox_label":c=Editor.details.contents.fields.checkbox.getActiveCheckboxField(),Editor.validation.check(f,["label"])?(questions[g].fields[h].values[c].label=f,$(this).val(f)):($(this).val(questions[g].fields[h].values[c].label),alert("Did not pass validation!"),b.preventDefault())}("checkbox_id"===i||"checkbox_label"===i)&&(e=$("#checkbox-field-values"),e.html(d(questions[g].fields[h].values)),e.find("[data-checkbox-item-index='"+a+"']").addClass("active")),Editor.thumbnail.buildThumbnail(g)}),$(".cfcia").live("click",function(){var b,e,f,g,h,i,j=Editor.main.getCurrentQuestion(),k=Editor.details.contents.fields.common.getActiveField(),l=$(this).data("c-field-cmd");"add"===l?(b=$("#checkbox-field-values"),e=$("#field-item"),g={id:"rid",label:"New checkbox Label"},a=questions[j].fields[k].values.push(g)-1,b.html(d(questions[j].fields[k].values)),b.find("[data-checkbox-item-index='"+a+"']").addClass("active"),$("#checkbox-field-block").html(c(questions[j].fields[k].values[a]))):"remove"===l?null!==a&&(b=$("#checkbox-field-values"),f=questions[j].fields[k].values,delete questions[j].fields[k].values[a],a=null,questions[j].fields[k].values=Editor.utils.rebuildArray(f),b.html(d(questions[j].fields[k].values)),$("#checkbox-field-block").html("")):"up"===l?null!==a&&0!==a&&(f=questions[j].fields[k].values[a],b=$("#checkbox-field-values"),h=1,questions[j].fields[k].values[a]=questions[j].fields[k].values[a-h],questions[j].fields[k].values[a-h]=f,b.html(d(questions[j].fields[k].values)),a-=h,b.find("[data-checkbox-item-index='"+a+"']").addClass("active")):"down"===l&&(i=questions[j].fields[k].values.length-1,null!==a&&a!==i&&(f=questions[j].fields[k].values[a],b=$("#checkbox-field-values"),h=1,questions[j].fields[k].values[a]=questions[j].fields[k].values[a+h],questions[j].fields[k].values[a+h]=f,b.html(d(questions[j].fields[k].values)),a+=h,b.find("[data-checkbox-item-index='"+a+"']").addClass("active"))),Editor.thumbnail.buildThumbnail(j)})},c=function(a){var b=[];return b.push('<div class="field-checkbox-value-property">'),b.push('<div class="d-label">ID: </div>'),b.push('<input type="text" value="'+a.id.replace(/"/g,"&quot;")+'" class="checkbox-field-textbox ae" data-field-textbox-id="checkbox_id" />'),b.push("</div>"),b.push('<div class="field-checkbox-value-property">'),b.push('<div class="d-label">Label: </div>'),b.push('<input type="text" value="'+a.label.replace(/"/g,"&quot;")+'" class="checkbox-field-textbox ae" data-field-textbox-id="checkbox_label" />'),b.push("</div>"),b.join("")},d=function(a){for(var b=[],c=0;c<a.length;c+=1)a[c]&&(b.push('<div data-checkbox-item-index="'+c+'" class="checkbox-field-value">'),b.push(a[c].label),b.push("</div>"));return b.join("")},e=function(a){var b=[];return b.push('<div class="clear"></div>'),b.push('<div class="c-label">Values: </div>'),b.push('<div class="checkbox-field-values-container">'),b.push('<div id="checkbox-field-values">'),b.push(d(a)),b.push("</div>"),b.push('<ul class="cf-c-list-controls">'),b.push('<li data-c-field-cmd="add" class="add unselectable cfcia">Add</li>'),b.push('<li data-c-field-cmd="up" class="up unselectable cfcia">Up</li>'),b.push('<li data-c-field-cmd="down" class="down unselectable cfcia">Down</li>'),b.push('<li data-c-field-cmd="remove" class="remove unselectable cfcia">Remove</li>'),b.push("</ul>"),b.push('<div id="checkbox-field-block"></div>'),b.push("</div>"),b.join("")};return{init:function(){b()},buildCheckboxField:function(a,b){var c=[],d="checkbox",f=Editor.details.contents.fields.common;return c.push(f.fieldType(d)),c.push(f.fieldName(a.name,b)),c.push(f.fieldLabel(a.label,b)),c.push(f.fieldValidation(a.validation,d,b)),c.push(e(a.values)),c.join("")},defaultCheckboxField:function(){return{name:"var",label:"",type:"checkbox",values:[{id:"c1",label:"Checkbox 1"},{id:"c2",label:"Checkbox 2"}],validation:{nota:"no"}}},setActiveCheckboxField:function(b){a=b},getActiveCheckboxField:function(){return a}}}();var Editor=Editor||{};Editor.details=Editor.details||{},Editor.details.contents=Editor.details.contents||{},Editor.details.contents.fields=Editor.details.contents.fields||{},Editor.details.contents.fields.common=function(){"use strict";var a=null,b=function(){$(".field-item").live("click",function(){var b=$(this).data("field-index");if(b!==a){var c=Editor.main.getCurrentQuestion(),d=questions[c].fields[b].type;null!==a&&$("#cf-list").find("[data-field-index='"+a+"']").removeClass("active"),a=b,$(this).addClass("active"),$("#field-item").html(Editor.details.contents.fields.common.field(c,d,b))}}),$(".field-textbox").live("change",function(a){var b,d=$(this).val().trim(),e=Editor.main.getCurrentQuestion(),f=Editor.details.contents.fields.common.getActiveField(),g=$(this).data("field-textbox-id");switch(g){case"name":Editor.validation.check(d,["required","variable"])?(questions[e].fields[f].name=d,$(this).val(d)):($(this).val(questions[e].fields[f].name),alert("This field is required."),a.preventDefault());break;case"label":Editor.validation.check(d,["label"])?(questions[e].fields[f].label=d,$(this).val(d)):($(this).val(questions[e].fields[f].label),alert("Only letters and numbers are allowed."),a.preventDefault());break;case"default":Editor.validation.check(d,["alphnum"])?(questions[e].fields[f].def=d,$(this).val(d)):($(this).val(questions[e].fields[f].def),alert("Only letter and numbers allowed."),a.preventDefault());break;case"default_date":Editor.validation.check(d,["label"])?(questions[e].fields[f].def=d,$(this).val(d)):($(this).val(questions[e].fields[f].def),alert("The default only allows alphanumeric and some special characters like dash, and forward slash."),a.preventDefault());break;case"start":Editor.validation.check(d,["required","integer"])?(questions[e].fields[f].start=d,$(this).val(d)):($(this).val(questions[e].fields[f].start),alert("Must be an integer."),a.preventDefault());break;case"end":Editor.validation.check(d,["required","integer"])?(questions[e].fields[f].end=d,$(this).val(d)):($(this).val(questions[e].fields[f].end),alert("Must be an integer."),a.preventDefault());break;case"default_number":Editor.validation.check(d,["number"])?(questions[e].fields[f].def=d,$(this).val(d)):($(this).val(questions[e].fields[f].def),alert("Number only."),a.preventDefault());break;case"default_textdropdown":Editor.validation.check(d,["variable"])?(questions[e].fields[f]["default"]=d,$(this).val(d)):($(this).val(questions[e].fields[f].def),alert("Letters and numbers only. First character must be a letter."),a.preventDefault());break;case"less_than":Editor.validation.check(d,["number"])?(questions[e].fields[f].validation.less_than=d,$(this).val(d)):($(this).val(questions[e].fields[f].validation.less_than),alert("Number only."),a.preventDefault());break;case"greater_than":Editor.validation.check(d,["number"])?(questions[e].fields[f].validation.greater_than=d,$(this).val(d)):($(this).val(questions[e].fields[f].validation.greater_than),alert("Number only."),a.preventDefault());break;case"min_length":Editor.validation.check(d,["integer"])?(questions[e].fields[f].validation.min_length=d,$(this).val(d)):($(this).val(questions[e].fields[f].validation.min_length),alert("The min length refers to the minimum number of characters the field must contain. This must be a whole number."),a.preventDefault());break;case"max_length":Editor.validation.check(d,["integer"])?(questions[e].fields[f].validation.max_length=d,$(this).val(d)):($(this).val(questions[e].fields[f].validation.max_length),alert("The max length refers to the maximum number of characters the field must contain. This must be a whole number."),a.preventDefault());break;case"min_date":Editor.validation.check(d,["date"])?(questions[e].fields[f].validation.min_date=d,$(this).val(d)):($(this).val(questions[e].fields[f].validation.min_date),alert("The date can only contain numbers and slashes."),a.preventDefault());break;case"max_date":Editor.validation.check(d,["date"])?(questions[e].fields[f].validation.max_date=d,$(this).val(d)):($(this).val(questions[e].fields[f].validation.max_date),alert("The date can only contain numbers and slashes."),a.preventDefault());break;case"validate_message":Editor.validation.check(d,["label"])?(questions[e].fields[f].validation.message=d,$(this).val(d)):($(this).val(questions[e].fields[f].validation.message),alert("Only text, numbers, and a few special characters are allowed here."),a.preventDefault())}("name"===g||"label"===g)&&(b=$("#cf-list"),b.html(c(questions[e].fields)),b.find("[data-field-index='"+f+"']").addClass("active")),Editor.thumbnail.buildThumbnail(e)}),$(".cfia").live("click",function(){var b,d,e,f,g,h,i=Editor.main.getCurrentQuestion(),j=$(this).data("field-cmd");"add"===j?(b=$("#cf-list"),d=$("#field-item"),e=Editor.details.contents.fields.common.defaultField("text"),a=questions[i].fields.push(e)-1,questions[i].fields[a].name=i+"_"+a,b.html(c(questions[i].fields)),b.find("[data-field-index='"+a+"']").addClass("active"),d.html(Editor.details.contents.fields.common.field(i,"text",a))):"remove"===j?null!==a&&(f=questions[i].fields,delete questions[i].fields[a],a=null,questions[i].fields=Editor.utils.rebuildArray(f),$("#cf-list").html(c(questions[i].fields)),$("#field-item").html("")):"up"===j?null!==a&&0!==a&&(f=questions[i].fields[a],b=$("#cf-list"),g=1,questions[i].fields[a]=questions[i].fields[a-g],questions[i].fields[a-g]=f,$("#cf-list").html(c(questions[i].fields)),a-=g,b.find("[data-field-index='"+a+"']").addClass("active"),$("#field-item").html(Editor.details.contents.fields.common.field(i,questions[i].fields[a].type,a))):"down"===j&&(h=questions[i].fields.length-1,null!==a&&a!==h&&(f=questions[i].fields[a],b=$("#cf-list"),g=1,questions[i].fields[a]=questions[i].fields[a+g],questions[i].fields[a+g]=f,b.html(c(questions[i].fields)),a+=g,b.find("[data-field-index='"+a+"']").addClass("active"),$("#field-item").html(Editor.details.contents.fields.common.field(i,questions[i].fields[a].type,a)))),Editor.thumbnail.buildThumbnail(i)}),$("#field-type-dd").live("change",function(){var b=Editor.main.getCurrentQuestion(),c=$("#field-type-dd option:selected").text(),d=$("#field-item"),e=questions[b].fields[a].name,f=questions[b].fields[a].label,g=Editor.details.contents.fields.common.defaultField(c);questions[b].fields[a]=g,questions[b].fields[a].name=e,questions[b].fields[a].label=f,d.html(Editor.details.contents.fields.common.field(b,c,a)),Editor.thumbnail.buildThumbnail(b)}),$("#field-size-dd").live("change",function(){var a=Editor.main.getCurrentQuestion(),b=$(this).data("field-index"),c=$("#field-size-dd option:selected").val();questions[a].fields[b].size=c}),$(".field-validation-checkbox").live("change",function(){var a=Editor.main.getCurrentQuestion(),b=$(this).data("field-index"),c=$(this).data("field-checkbox-id");questions[a].fields[b].validation[c]=$(this).is(":checked")?"yes":"no",Editor.thumbnail.buildThumbnail(a)}),$(".field-checkbox").live("change",function(){var a=Editor.main.getCurrentQuestion(),b=$(this).data("field-index"),c=$(this).data("field-checkbox-id");switch(c){case"descending":questions[a].fields[b][c]=$(this).is(":checked")?"yes":"no";break;case"line":questions[a].fields[b][c]=$(this).is(":checked")?"yes":"no"}})},c=function(a){var b=[];b.push("<ul>");for(var c=0;c<a.length;c+=1)a[c]&&(b.push('<li data-field-index="'+c+'" class="field-item">'),b.push(a[c].label?"<span>"+a[c].label+' </span><span class="a-label">('+a[c].name+")</span>":'<span class="a-label">'+a[c].name+"</span>"),b.push("</li>"));return b.push("</ul>"),b.join("")};return{init:function(){b(),Editor.details.contents.fields.radio.init(),Editor.details.contents.fields.checkbox.init(),Editor.details.contents.fields.date.init(),Editor.details.contents.fields.numberDropdown.init(),Editor.details.contents.fields.textDropdown.init()},fieldType:function(a){var b=[],c=["text","textarea","number","radio","date","checkbox","text_dropdown","number_dropdown"];b.push('<div class="field-property">'),b.push('<div class="b-label">Type: </div>'),b.push('<select id="field-type-dd" class="large-dropdown">');for(var d=0;d<c.length;d+=1)b.push(c[d]===a?'<option selected="selected">'+c[d]+"</option>":"<option>"+c[d]+"</option>");return b.push("</select>"),b.push("</div>"),b.join("")},fieldName:function(a,b){var c=[];return c.push('<div class="field-property">'),c.push('<div class="b-label">Name: </div>'),c.push('<input type="text" value="'+a.replace(/"/g,"&quot;")+'" class="field-textbox ac" data-field-textbox-id="name" data-field-index="'+b+'" />'),c.push("</div>"),c.join("")},fieldLabel:function(a,b){var c=[];return a||(a=""),c.push('<div class="field-property">'),c.push('<div class="b-label">Label: </div>'),c.push('<input type="text" value="'+a.replace(/"/g,"&quot;")+'" class="field-textbox ac" data-field-textbox-id="label" data-field-index="'+b+'" />'),c.push("</div>"),c.join("")},fieldSize:function(a,b){var c=[];a||(a=3);var d=[{id:1,name:"small"},{id:2,name:"medium"},{id:3,name:"large"},{id:4,name:"x-large"}];c.push('<div class="field-property">'),c.push('<div class="b-label">Size: </div>'),c.push('<select id="field-size-dd" class="large-dropdown"  data-field-index="'+b+'">');for(var e=0;e<d.length;e+=1)c.push(d[e].id==a?'<option selected="selected" value="'+d[e].id+'">'+d[e].name+"</option>":'<option value="'+d[e].id+'">'+d[e].name+"</option>");return c.push("</select>"),c.push("</div>"),c.join("")},fieldLine:function(a,b){var c=[];

return a||(a="yes"),c.push('<div class="field-property">'),c.push('<div class="b-label">Seperate Line: </div>'),c.push("yes"===a?'<input type="checkbox" checked="yes" class="field-checkbox" data-field-checkbox-id="line" data-field-index="'+b+'"/>':'<input type="checkbox" class="field-checkbox" data-field-checkbox-id="line" data-field-index="'+b+'" />'),c.push("</div>"),c.join("")},fieldDefault:function(a,b){var c=[];return a||(a=""),c.push('<div class="field-property">'),c.push('<div class="b-label">Default: </div>'),c.push('<input type="text" value="'+a.replace(/"/g,"&quot;")+'" class="field-textbox ac" data-field-textbox-id="default" data-field-index="'+b+'"/>'),c.push("</div>"),c.join("")},fieldValidation:function(a,b,c){var d=[],e=Editor.details.contents.fields.common.defaultField(b);d.push('<div class="clear"></div>'),d.push('<div class="field-validations">');for(var f in e.validation)if(e.validation.hasOwnProperty(f))switch(f){case"required":d.push('<div class="field-validation">'),d.push('<div class="b-label">Required: </div>'),d.push("yes"===a[f]?'<input type="checkbox" checked="yes" class="field-validation-checkbox" data-field-checkbox-id="required" data-field-index="'+c+'"/>':'<input type="checkbox" class="field-validation-checkbox" data-field-checkbox-id="required" data-field-index="'+c+'" />'),d.push("</div>");break;case"nota":d.push('<div class="field-validation">'),d.push('<div class="b-label">None of the above: </div>'),d.push("yes"===a[f]?'<input type="checkbox" checked="yes" class="field-validation-checkbox" data-field-checkbox-id="nota" data-field-index="'+c+'"/>':'<input type="checkbox" class="field-validation-checkbox" data-field-checkbox-id="nota" data-field-index="'+c+'" />'),d.push("</div>");break;case"min_length":d.push('<div class="field-validation">'),d.push('<div class="b-label">Minimun length: </div>'),d.push(null!==a[f]?'<input type="text" value="'+a[f].replace(/"/g,"&quot;")+'" class="field-textbox ac" data-field-textbox-id="min_length" data-field-index="'+c+'"/>':'<input type="text" value="" class="field-textbox ac" data-field-textbox-id="min_length" data-field-index="'+c+'"/>'),d.push("</div>");break;case"max_length":d.push('<div class="field-validation">'),d.push('<div class="b-label">Maximum length: </div>'),d.push(null!==a[f]?'<input type="text" value="'+a[f].replace(/"/g,"&quot;")+'" class="field-textbox ac" data-field-textbox-id="max_length" data-field-index="'+c+'"/>':'<input type="text" value="" class="field-textbox ac" data-field-textbox-id="max_length" data-field-index="'+c+'"/>'),d.push("</div>");break;case"less_than":d.push('<div class="field-validation">'),d.push('<div class="b-label">Less than: </div>'),d.push(null!==a[f]?'<input type="text" value="'+a[f].replace(/"/g,"&quot;")+'" class="field-textbox ac" data-field-textbox-id="less_than" data-field-index="'+c+'"/>':'<input type="text" value="" class="field-textbox ac" data-field-textbox-id="less_than" data-field-index="'+c+'"/>'),d.push("</div>");break;case"greater_than":d.push('<div class="field-validation">'),d.push('<div class="b-label">Greater than: </div>'),d.push(null!==a[f]?'<input type="text" value="'+a[f].replace(/"/g,"&quot;")+'" class="field-textbox ac" data-field-textbox-id="greater_than" data-field-index="'+c+'"/>':'<input type="text" value="" class="field-textbox ac" data-field-textbox-id="greater_than" data-field-index="'+c+'"/>'),d.push("</div>");break;case"min_date":d.push('<div class="field-validation">'),d.push('<div class="b-label">Minimum date: </div>'),d.push(null!==a[f]?'<input type="text" value="'+a[f].replace(/"/g,"&quot;")+'" class="field-textbox ac" data-field-textbox-id="min_date" data-field-index="'+c+'"/>':'<input type="text" value="" class="field-textbox ac" data-field-textbox-id="min_date" data-field-index="'+c+'"/>'),d.push("</div>");break;case"max_date":d.push('<div class="field-validation">'),d.push('<div class="b-label">Maximum date: </div>'),d.push(null!==a[f]?'<input type="text" value="'+a[f].replace(/"/g,"&quot;")+'" class="field-textbox ac" data-field-textbox-id="max_date" data-field-index="'+c+'"/>':'<input type="text" value="" class="field-textbox ac" data-field-textbox-id="max_date" data-field-index="'+c+'"/>'),d.push("</div>")}return d.push("</div>"),d.join("")},defaultField:function(a){switch(a){case"text":return Editor.details.contents.fields.text.defaultTextField();case"textarea":return Editor.details.contents.fields.textarea.defaultTextareaField();case"number":return Editor.details.contents.fields.number.defaultNumberField();case"radio":return Editor.details.contents.fields.radio.defaultRadioField();case"date":return Editor.details.contents.fields.date.defaultDateField();case"checkbox":return Editor.details.contents.fields.checkbox.defaultCheckboxField();case"text_dropdown":return Editor.details.contents.fields.textDropdown.defaultTextDropdownField();case"number_dropdown":return Editor.details.contents.fields.numberDropdown.defaultNumberDropdownField()}},buildFields:function(a){$("#cf-list").html(c(questions[a].fields))},field:function(a,b,c){var d="",e=Editor.details.contents.fields;switch(b){case"text":d=e.text.buildTextField(questions[a].fields[c],c);break;case"textarea":d=e.textarea.buildTextareaField(questions[a].fields[c],c);break;case"number":d=e.number.buildNumberField(questions[a].fields[c],c);break;case"radio":d=e.radio.buildRadioField(questions[a].fields[c],c);break;case"date":d=e.date.buildDateField(questions[a].fields[c],c);break;case"checkbox":d=e.checkbox.buildCheckboxField(questions[a].fields[c],c);break;case"text_dropdown":d=e.textDropdown.buildTextDropdownField(questions[a].fields[c],c);break;case"number_dropdown":d=e.numberDropdown.buildNumberDropdownField(questions[a].fields[c],c)}return d},emptyFields:function(){a=null,Editor.details.contents.fields.radio.setActiveRadioField(null),Editor.details.contents.fields.checkbox.setActiveCheckboxField(null),$("#cf-list").html(""),$("#field-item").html("")},getActiveField:function(){return a}}}();var Editor=Editor||{};Editor.details=Editor.details||{},Editor.details.contents=Editor.details.contents||{},Editor.details.contents.fields=Editor.details.contents.fields||{},Editor.details.contents.fields.date=function(){"use strict";var a=function(){$("#date-field-format-dd").live("change",function(){var a=Editor.details.contents.fields.common.getActiveField(),b=Editor.main.getCurrentQuestion(),c=$("#date-field-format-dd option:selected").text();questions[b].fields[a].format=c}),$("#validation-condition-textarea").live("change",function(){var a=Editor.details.contents.fields.common.getActiveField(),b=$(this).val().trim(),c=Editor.main.getCurrentQuestion();Editor.validation.check(b,["condition"])?(questions[c].fields[a].validation.condition=b,$(this).val(b)):($(this).val(questions[c].fields[a].validation.condition),alert("This field is required."),e.preventDefault())})},b=function(a,b){var c=[];return a||(a=""),c.push('<div class="field-property">'),c.push('<div class="b-label">Default: </div>'),c.push('<input type="text" value="'+a.replace(/"/g,"&quot;")+'" class="field-textbox ac" data-field-textbox-id="default_date" data-field-index="'+b+'"/>'),c.push("</div>"),c.join("")},c=function(a){var b=[],c=["dd/mm/yy","mm/dd/yy"];b.push('<div class="field-property">'),b.push('<div class="b-label">Format: </div>'),b.push('<select class="large-dropdown" id="date-field-format-dd">');for(var d=0;d<c.length;d+=1)b.push(c[d]===a?'<option selected="selected">'+c[d]+"</option>":"<option>"+c[d]+"</option>");return b.push("</select>"),b.push("</div>"),b.join("")},d=function(a,b,c){var d=[];return a="undefined"!=typeof a&&null!==a?a:"",b="undefined"!=typeof b&&null!==b?b:"",d.push('<div class="field-property">'),d.push('<div class="b-label">Condition: </div>'),d.push('<textarea id="validation-condition-textarea" class="text-area-def-3">'+a+"</textarea>"),d.push("</div>"),d.push('<div class="field-property">'),d.push('<div class="b-label">Message: </div>'),d.push('<input type="text" value="'+b.replace(/"/g,"&quot;")+'" class="field-textbox ac" data-field-textbox-id="validate_message" data-field-index="'+c+'"/>'),d.push("</div>"),d.join("")};return{init:function(){a()},buildDateField:function(a,e){var f=[],g="date",h=Editor.details.contents.fields.common;return f.push(h.fieldType(g)),f.push(h.fieldName(a.name,e)),f.push(h.fieldLabel(a.label,e)),f.push(h.fieldSize(a.size,e)),f.push(h.fieldLine(a.line,e)),f.push(b(a.def,e)),f.push(c(a.format,e)),f.push(h.fieldValidation(a.validation,g,e)),f.push(d(a.validation.condition,a.validation.message,e)),f.join("")},defaultDateField:function(){return{name:"var",label:"",type:"date",def:"",format:"mm/dd/yy",validation:{required:"no",min_date:"",max_date:"",condition:"",message:""}}}}}();var Editor=Editor||{};Editor.details=Editor.details||{},Editor.details.contents=Editor.details.contents||{},Editor.details.contents.fields=Editor.details.contents.fields||{},Editor.details.contents.fields.number=function(){"use strict";var a=function(a,b){var c=[];return a||(a=""),c.push('<div class="field-property">'),c.push('<div class="b-label">Default: </div>'),c.push('<input type="text" value="'+a+'" class="field-textbox ac" data-field-textbox-id="default" data-field-index="'+b+'"/>'),c.push("</div>"),c.join("")};return{buildNumberField:function(b,c){var d=[],e="number",f=Editor.details.contents.fields.common;return d.push(f.fieldType(e)),d.push(f.fieldName(b.name,c)),d.push(f.fieldLabel(b.label,c)),d.push(f.fieldSize(b.size,c)),d.push(f.fieldLine(b.line,c)),d.push(a(b.def,c)),d.push(f.fieldValidation(b.validation,e,c)),d.join("")},defaultNumberField:function(){return{name:"var",label:"",type:"number",def:null,validation:{required:"no",less_than:null,greater_than:null}}}}}();var Editor=Editor||{};Editor.details=Editor.details||{},Editor.details.contents=Editor.details.contents||{},Editor.details.contents.fields=Editor.details.contents.fields||{},Editor.details.contents.fields.numberDropdown=function(){"use strict";var a=function(){},b=function(a,b){var c=[];return a||(a=""),c.push('<div class="field-property">'),c.push('<div class="b-label">Default: </div>'),c.push('<input type="text" value="'+a.toString(10).replace(/"/g,"&quot;")+'" class="field-textbox ac" data-field-textbox-id="default" data-field-index="'+b+'"/>'),c.push("</div>"),c.join("")},c=function(a,b){var c=[];return c.push('<div class="field-property">'),c.push('<div class="b-label">Start: </div>'),c.push('<input type="text" value="'+a+'" class="field-textbox ac" data-field-textbox-id="start" data-field-index="'+b+'"/>'),c.push("</div>"),c.join("")},d=function(a,b){var c=[];return c.push('<div class="field-property">'),c.push('<div class="b-label">End: </div>'),c.push('<input type="text" value="'+a+'" class="field-textbox ac" data-field-textbox-id="end" data-field-index="'+b+'"/>'),c.push("</div>"),c.join("")},e=function(a,b){var c=[];return c.push('<div class="field-property">'),c.push('<div class="b-label">Descending: </div>'),c.push("yes"===a?'<input type="checkbox" checked="yes" class="field-checkbox" data-field-checkbox-id="descending" data-field-index="'+b+'"/>':'<input type="checkbox" class="field-checkbox" data-field-checkbox-id="descending" data-field-index="'+b+'" />'),c.push("</div>"),c.join("")};return{init:function(){a()},buildNumberDropdownField:function(a,f){var g=[],h="number_dropdown",i=Editor.details.contents.fields.common;return g.push(i.fieldType(h)),g.push(i.fieldName(a.name,f)),g.push(i.fieldLabel(a.label,f)),g.push(i.fieldSize(a.size,f)),g.push(i.fieldLine(a.line,f)),g.push(b(a.def,f)),g.push(c(a.start,f)),g.push(d(a.end,f)),g.push(e(a.descending,f)),g.push(i.fieldValidation(a.validation,h,f)),g.join("")},defaultNumberDropdownField:function(){return{name:"var",label:"",type:"number_dropdown",def:"",start:0,end:10,descending:"no",validation:{required:"no"}}}}}();var Editor=Editor||{};Editor.details=Editor.details||{},Editor.details.contents=Editor.details.contents||{},Editor.details.contents.fields=Editor.details.contents.fields||{},Editor.details.contents.fields.radio=function(){"use strict";var a=null,b=function(){$(".radio-field-value").live("click",function(){var b=Editor.main.getCurrentQuestion();null!==a&&$("#radio-field-values").find("[data-radio-item-index='"+a+"']").removeClass("active");var d=Editor.details.contents.fields.common.getActiveField(),e=$(this).data("radio-item-index");a=e,$(this).addClass("active"),$("#radio-field-block").html(c(questions[b].fields[d].values[a]))}),$(".radio-field-textbox").live("change",function(b){var c,e,f=$(this).val().trim(),g=Editor.main.getCurrentQuestion(),h=Editor.details.contents.fields.common.getActiveField(),i=$(this).data("field-textbox-id");switch(i){case"radio_id":c=Editor.details.contents.fields.radio.getActiveRadioField(),Editor.validation.check(f,["required","variable"])?(questions[g].fields[h].values[c].id=f,$(this).val(f)):($(this).val(questions[g].fields[h].values[c].id),alert("Letter and numbers only. The first character must be a letter."),b.preventDefault());break;case"radio_label":c=Editor.details.contents.fields.radio.getActiveRadioField(),Editor.validation.check(f,["label"])?(questions[g].fields[h].values[c].label=f,$(this).val(f)):($(this).val(questions[g].fields[h].values[c].label),alert("Letter and numbers only."),b.preventDefault())}("radio_id"===i||"radio_label"===i)&&(e=$("#radio-field-values"),e.html(d(questions[g].fields[h].values)),e.find("[data-radio-item-index='"+a+"']").addClass("active")),Editor.thumbnail.buildThumbnail(g)}),$(".cfria").live("click",function(){var b,e,f,g,h,i,j=Editor.main.getCurrentQuestion(),k=Editor.details.contents.fields.common.getActiveField(),l=$(this).data("r-field-cmd");"add"===l?(b=$("#radio-field-values"),e=$("#field-item"),i={id:"rid",label:"New Radio Label"},a=questions[j].fields[k].values.push(i)-1,b.html(d(questions[j].fields[k].values)),b.find("[data-radio-item-index='"+a+"']").addClass("active"),$("#radio-field-block").html(c(questions[j].fields[k].values[a]))):"remove"===l?null!==a&&(b=$("#radio-field-values"),f=questions[j].fields[k].values,delete questions[j].fields[k].values[a],questions[j].fields[k].values=Editor.utils.rebuildArray(f),a=null,b.html(d(questions[j].fields[k].values)),$("#radio-field-block").html("")):"up"===l?null!==a&&0!==a&&(f=questions[j].fields[k].values[a],b=$("#radio-field-values"),g=1,questions[j].fields[k].values[a]=questions[j].fields[k].values[a-g],questions[j].fields[k].values[a-g]=f,b.html(d(questions[j].fields[k].values)),a-=g,b.find("[data-radio-item-index='"+a+"']").addClass("active")):"down"===l&&(h=questions[j].fields[k].values.length-1,null!==a&&a!==h&&(f=questions[j].fields[k].values[a],b=$("#radio-field-values"),g=1,questions[j].fields[k].values[a]=questions[j].fields[k].values[a+g],questions[j].fields[k].values[a+g]=f,b.html(d(questions[j].fields[k].values)),a+=g,b.find("[data-radio-item-index='"+a+"']").addClass("active"))),Editor.thumbnail.buildThumbnail(j)})},c=function(a){var b=[];return b.push('<div class="field-radio-value-property">'),b.push('<div class="d-label">ID: </div>'),b.push('<input type="text" value="'+a.id+'" class="radio-field-textbox ae" data-field-textbox-id="radio_id" />'),b.push("</div>"),b.push('<div class="field-radio-value-property">'),b.push('<div class="d-label">Label: </div>'),b.push('<input type="text" value="'+a.label+'" class="radio-field-textbox ae" data-field-textbox-id="radio_label" />'),b.push("</div>"),b.join("")},d=function(a){for(var b=[],c=0;c<a.length;c+=1)a[c]&&(b.push('<div data-radio-item-index="'+c+'" class="radio-field-value">'),b.push(a[c].label+" ("+a[c].id+")"),b.push("</div>"));return b.join("")},e=function(a){var b=[];return b.push('<div class="clear"></div>'),b.push('<div class="c-label">Values: </div>'),b.push('<div class="radio-field-values-container">'),b.push('<div id="radio-field-values">'),b.push(d(a)),b.push("</div>"),b.push('<ul class="cf-r-list-controls">'),b.push('<li data-r-field-cmd="add" class="add unselectable cfria">Add</li>'),b.push('<li data-r-field-cmd="up" class="up unselectable cfria">Up</li>'),b.push('<li data-r-field-cmd="down" class="down unselectable cfria">Down</li>'),b.push('<li data-r-field-cmd="remove" class="remove unselectable cfria">Remove</li>'),b.push("</ul>"),b.push('<div id="radio-field-block"></div>'),b.push("</div>"),b.join("")};return{init:function(){b()},buildRadioField:function(a,b){var c=[],d="radio",f=Editor.details.contents.fields.common;return c.push(f.fieldType(d)),c.push(f.fieldName(a.name,b)),c.push(f.fieldLabel(a.label,b)),c.push(f.fieldValidation(a.validation,d,b)),c.push(e(a.values)),c.join("")},defaultRadioField:function(){return{name:"var",label:"",type:"radio",def:null,values:[{id:"yes",label:"Yes"},{id:"no",label:"No"}],validation:{required:"yes"}}},setActiveRadioField:function(b){a=b},getActiveRadioField:function(){return a}}}();var Editor=Editor||{};Editor.details=Editor.details||{},Editor.details.contents=Editor.details.contents||{},Editor.details.contents.fields=Editor.details.contents.fields||{},Editor.details.contents.fields.text=function(){"use strict";return{buildTextField:function(a,b){var c=[],d="text",e=Editor.details.contents.fields.common;return c.push(e.fieldType(d)),c.push(e.fieldName(a.name,b)),c.push(e.fieldLabel(a.label,b)),c.push(e.fieldSize(a.size,b)),c.push(e.fieldLine(a.line,b)),c.push(e.fieldDefault(a.def,b)),c.push(e.fieldValidation(a.validation,d,b)),c.join("")},defaultTextField:function(){return{name:"",label:"",type:"text",def:null,size:3,validation:{required:"no",min_length:null,max_length:null}}}}}();var Editor=Editor||{};Editor.details=Editor.details||{},Editor.details.contents=Editor.details.contents||{},Editor.details.contents.fields=Editor.details.contents.fields||{},Editor.details.contents.fields.textDropdown=function(){"use strict";var a=null,b=function(){$(".textdropdown-field-value").live("click",function(){var b=Editor.main.getCurrentQuestion();null!==a&&$("#textdropdown-field-values").find("[data-textdropdown-item-index='"+a+"']").removeClass("active");var d=Editor.details.contents.fields.common.getActiveField(),e=$(this).data("textdropdown-item-index");a=e,$(this).addClass("active"),$("#textdropdown-field-block").html(c(questions[b].fields[d].values[a]))}),$(".textdropdown-field-textbox").live("change",function(b){var c,e,f=$(this).val().trim(),g=Editor.main.getCurrentQuestion(),h=Editor.details.contents.fields.common.getActiveField(),i=$(this).data("field-textbox-id");switch(i){case"textdropdown_id":c=Editor.details.contents.fields.textDropdown.getActiveTextDropdownField(),Editor.validation.check(f,["required","variable"])?(questions[g].fields[h].values[c].id=f,$(this).val(f)):($(this).val(questions[g].fields[h].values[c].id),alert("Letter and numbers only. The first character must be a letter."),b.preventDefault());break;case"textdropdown_label":c=Editor.details.contents.fields.textDropdown.getActiveTextDropdownField(),Editor.validation.check(f,["label"])?(questions[g].fields[h].values[c].label=f,$(this).val(f)):($(this).val(questions[g].fields[h].values[c].label),alert("Letter and numbers only."),b.preventDefault())}("textdropdown_id"===i||"textdropdown_label"===i)&&(e=$("#textdropdown-field-values"),e.html(d(questions[g].fields[h].values)),e.find("[data-textdropdown-item-index='"+a+"']").addClass("active"))}),$(".cftdia").live("click",function(){var b,e,f,g,h,i,j=Editor.main.getCurrentQuestion(),k=Editor.details.contents.fields.common.getActiveField(),l=$(this).data("td-field-cmd");"add"===l?(b=$("#textdropdown-field-values"),e=$("#field-item"),f={id:"rid",label:"New text dropdown Label"},a=questions[j].fields[k].values.push(f)-1,b.html(d(questions[j].fields[k].values)),b.find("[data-textdropdown-item-index='"+a+"']").addClass("active"),$("#textdropdown-field-block").html(c(questions[j].fields[k].values[a]))):"remove"===l?null!==a&&(b=$("#textdropdown-field-values"),g=questions[j].fields[k].values,delete questions[j].fields[k].values[a],a=null,questions[j].fields[k].values=Editor.utils.rebuildArray(g),b.html(d(questions[j].fields[k].values)),$("#textdropdown-field-block").html("")):"up"===l?null!==a&&0!==a&&(g=questions[j].fields[k].values[a],b=$("#textdropdown-field-values"),h=1,questions[j].fields[k].values[a]=questions[j].fields[k].values[a-h],questions[j].fields[k].values[a-h]=g,b.html(d(questions[j].fields[k].values)),a-=h,b.find("[data-textdropdown-item-index='"+a+"']").addClass("active")):"down"===l&&(i=questions[j].fields[k].values.length-1,null!==a&&a!==i&&(g=questions[j].fields[k].values[a],b=$("#textdropdown-field-values"),h=1,questions[j].fields[k].values[a]=questions[j].fields[k].values[a+h],questions[j].fields[k].values[a+h]=g,b.html(d(questions[j].fields[k].values)),a+=h,b.find("[data-textdropdown-item-index='"+a+"']").addClass("active")))})},c=function(a){var b=[];return b.push('<div class="field-textdropdown-value-property">'),b.push('<div class="d-label">ID: </div>'),b.push('<input type="text" value="'+a.id+'" class="textdropdown-field-textbox ae" data-field-textbox-id="textdropdown_id" />'),b.push("</div>"),b.push('<div class="field-textdropdown-value-property">'),b.push('<div class="d-label">Label: </div>'),b.push('<input type="text" value="'+a.label.replace(/"/g,"&quot;")+'" class="textdropdown-field-textbox ae" data-field-textbox-id="textdropdown_label" />'),b.push("</div>"),b.join("")},d=function(a){for(var b=[],c=0;c<a.length;c+=1)a[c]&&(b.push('<div data-textdropdown-item-index="'+c+'" class="textdropdown-field-value">'),b.push(a[c].label),b.push("</div>"));return b.join("")},e=function(a){var b=[];return b.push('<div class="clear"></div>'),b.push('<div class="c-label">Values: </div>'),b.push('<div class="textdropdown-field-values-container">'),b.push('<div id="textdropdown-field-values">'),b.push(d(a)),b.push("</div>"),b.push('<ul class="cf-td-list-controls">'),b.push('<li data-td-field-cmd="add" class="add unselectable cftdia">Add</li>'),b.push('<li data-td-field-cmd="up" class="up unselectable cftdia">Up</li>'),b.push('<li data-td-field-cmd="down" class="down unselectable cftdia">Down</li>'),b.push('<li data-td-field-cmd="remove" class="remove unselectable cftdia">Remove</li>'),b.push("</ul>"),b.push('<div id="textdropdown-field-block"></div>'),b.push("</div>"),b.join("")};return{init:function(){b()},buildTextDropdownField:function(a,b){var c=[],d="text_dropdown",f=Editor.details.contents.fields.common;return c.push(f.fieldType(d)),c.push(f.fieldName(a.name,b)),c.push(f.fieldLabel(a.label,b)),c.push(f.fieldSize(a.size,b)),c.push(f.fieldLine(a.line,b)),c.push(f.fieldDefault(a.def,b)),c.push(f.fieldValidation(a.validation,d,b)),c.push(e(a.values)),c.join("")},defaultTextDropdownField:function(){return{name:"var",label:"",type:"text_dropdown",def:"",values:[{id:"di1",label:"Dropdown Item 1"},{id:"di2",label:"Dropdown Item 2"}],validation:{required:"yes"}}},setActiveTextDropdownField:function(b){a=b},getActiveTextDropdownField:function(){return a}}}();var Editor=Editor||{};Editor.details=Editor.details||{},Editor.details.contents=Editor.details.contents||{},Editor.details.contents.fields=Editor.details.contents.fields||{},Editor.details.contents.fields.textarea=function(){"use strict";return{buildTextareaField:function(a,b){var c=[],d="textarea",e=Editor.details.contents.fields.common;return c.push(e.fieldType(d)),c.push(e.fieldName(a.name,b)),c.push(e.fieldLabel(a.label,b)),c.push(e.fieldSize(a.size,b)),c.push(e.fieldDefault(a.def,b)),c.push(e.fieldValidation(a.validation,d,b)),c.join("")},defaultTextareaField:function(){return{name:"",label:"",type:"textarea",def:null,validation:{required:"no",min_length:null,max_length:null}}}}}();var Editor=Editor||{};Editor.details=Editor.details||{},Editor.details.contents=Editor.details.contents||{},Editor.details.contents.learnmore=function(){"use strict";var a=function(){$(".lm-textbox").live("change",function(){var a=$(this).val().trim(),b=Editor.main.getCurrentQuestion(),c=$(this).data("lm-textbox-id");switch(c){case"title":Editor.validation.check(a,["label"])?(questions[b].learn_more.title=a,$(this).val(a)):($(this).val(questions[b].learn_more.title),alert("This field allows only spaces, letters, and numbers, #, $, -, %, &, *, /, \\, (, )"))}})};return{init:function(){a()},saveLearnmore:function(){var a=Editor.main.getCurrentQuestion();questions[a].learn_more.title=$("#q-d-lm-title").val(),questions[a].learn_more.body=$(".q-d-lm-wysihtml5").contents().find(".q-d-lm-wysihtml5").html()},buildLearnmore:function(a){$("#q-d-lm-title").val(questions[a].learn_more.title),$(".q-d-lm-wysihtml5").contents().find(".wysihtml5-editor").html(questions[a].learn_more.body)},emptyLearnmore:function(){$("#q-d-lm-title").html(""),$(".q-d-lm-wysihtml5").contents().find(".q-d-lm-wysihtml5").html("")}}}();var Editor=Editor||{};Editor.details=Editor.details||{},Editor.details.contents=Editor.details.contents||{},Editor.details.contents.question=function(){"use strict";var a=function(){$("#q-d-step").live("change",function(){var a=Editor.main.getCurrentQuestion(),b=$("#q-d-step option:selected").text();questions[a].step=b,Editor.list.orderList(null,a)}),$(".question-textbox").live("change",function(){var a=$(this).val().trim(),b=Editor.main.getCurrentQuestion(),c=$(this).data("question-textbox-id");switch(c){case"name":Editor.validation.check(a,["label"])?(questions[b].name=a,$(this).val(a)):($(this).val(questions[b].name),alert("This field allows only spaces, letters, numbers, #, $, -, %, &, *, /, \\, (, )"));break;case"loop1":Editor.validation.check(a,["variable"])?(questions[b].loop1=a,$(this).val(a)):($(this).val(questions[b].loop1),alert("This field can only contain letters, numbers, and underscores. The first character must be a letter."))}"name"===c&&Editor.list.orderList(null,b),Editor.thumbnail.buildThumbnail(b)})},b=function(a){var b=[],c=Editor.settings.getSteps();b.push('<select id="q-d-step" class="large-dropdown"><option>none</option>');for(var d=0;d<c.length;d+=1)c[d]&&b.push(c[d]===questions[a].step?'<option selected="selected">'+c[d]+"</option>":"<option>"+c[d]+"</option>");return b.push("</select>"),b.join("")};return{init:function(){a()},saveQuestion:function(){var a=Editor.main.getCurrentQuestion();questions[a].step=$("#q-d-step").val(),questions[a].name=$("#q-d-name").val(),questions[a].loop1=$("#q-d-loop1").val(),questions[a].question_text=$(".q-d-text-wysihtml5").contents().find(".wysihtml5-editor").html()},buildQuestion:function(a){$("#q-d-step-container").html(b(a)),$("#q-d-name").val(questions[a].name),$("#q-d-loop1").val(questions[a].loop1),$(".q-d-text-wysihtml5").contents().find(".wysihtml5-editor").html(questions[a].question_text)},emptyQuestion:function(){$("#q-d-step-container").html(""),$("#q-d-name").val(),$("#q-d-loop1").val(),$(".q-d-text-wysihtml5").contents().find(".wysihtml5-editor").html("")}}}();var Editor=Editor||{};Editor.details=Editor.details||{},Editor.details.manager=function(){"use strict";var a=function(){$("#q-d-close").live("click",function(){b()})},b=function(){$("#q-d").addClass("none"),Editor.main.updateDetailsStatus(!1),Editor.main.closeWindow("question"),Editor.menu.set(),Editor.details.manager.emptyQuestionDetails()};return{init:function(){a(),Editor.details.manager.wysihtml5()},wysihtml5:function(){var a=new wysihtml5.Editor("q-d-text-frame",{name:"q-d-text-wysihtml5",toolbar:"q-d-text-toolbar",stylesheets:["/stylesheets/wysihtml5-text.css"],parserRules:wysihtml5ParserRulesText});a.on("blur",function(){var a=Editor.main.getCurrentQuestion();Editor.details.contents.question.saveQuestion(),Editor.thumbnail.buildThumbnail(a)});var b=new wysihtml5.Editor("q-d-lm-frame",{name:"q-d-lm-wysihtml5",toolbar:"q-d-lm-toolbar",stylesheets:["/stylesheets/wysihtml5-lm.css"],parserRules:wysihtml5ParserRulesLM});b.on("blur",function(){Editor.details.contents.learnmore.saveLearnmore()})},showQuestionDetails:function(a){Editor.main.getDetailsStatus()&&(Editor.details.manager.emptyQuestionDetails(),$("#q-d").addClass("none"),Editor.main.updateDetailsStatus(!1),Editor.main.closeWindow("question")),Editor.details.tabs.setDefaultTab(),Editor.details.manager.buildTabContents("tab-1",a),$("#q-d").removeClass("none"),Editor.main.updateCurrentQuestion(a),Editor.main.updateDetailsStatus(!0),Editor.main.openWindow("question"),Editor.menu.set()},emptyQuestionDetails:function(){Editor.details.contents.question.emptyQuestion(),Editor.details.contents.learnmore.emptyLearnmore(),Editor.details.contents.fields.common.emptyFields(),Editor.details.contents.buttons.emptyButtons(),Editor.details.contents.advanced.emptyAdvanced()},buildTabContents:function(a,b){switch(("undefined"==typeof b||null===b)&&(b=Editor.main.getCurrentQuestion()),a){case"tab-1":Editor.details.contents.question.buildQuestion(b);break;case"tab-2":Editor.details.contents.learnmore.buildLearnmore(b);break;case"tab-3":Editor.details.contents.fields.common.buildFields(b);break;case"tab-4":Editor.details.contents.buttons.buildButtons(b);break;case"tab-5":Editor.details.contents.advanced.buildAdvanced(b)}},emptyTabContents:function(a){switch(a){case"tab-1":Editor.details.contents.question.emptyQuestion();break;case"tab-2":Editor.details.contents.learnmore.emptyLearnmore();break;case"tab-3":Editor.details.contents.fields.common.emptyFields();break;case"tab-4":Editor.details.contents.buttons.emptyButtons();break;case"tab-5":Editor.details.contents.advanced.emptyAdvanced()}},closeQuestion:function(){b()}}}();var Editor=Editor||{};Editor.details=Editor.details||{},Editor.details.tabs=function(){"use strict";var a=null,b="tab-1";return{init:function(){a=b,Editor.details.tabs.showActive(a),Editor.details.tabs.eventListeners()},eventListeners:function(){$(".tab-menu").live("click",function(){var b,c=$(this).data("tab-command");c!==a&&(b=a,Editor.details.manager.emptyTabContents(b),$(".tab-menu").removeClass("open"),$(this).addClass("open"),Editor.details.tabs.showActive(c))})},showActive:function(a){Editor.details.tabs.hideTabs(),Editor.details.tabs.setActiveTab(a),Editor.details.manager.buildTabContents(a),$("#tab-contents #"+a).show()},hideTabs:function(){$(".tab").hide()},getActiveTab:function(){return a},setActiveTab:function(b){a=b},setDefaultTab:function(){Editor.details.tabs.hideTabs(),$(".tab-menu").removeClass("open"),$("#tabs-menu-list").find("[data-tab-command='"+b+"']").addClass("open"),Editor.details.tabs.setActiveTab(b),$("#tab-contents #"+b).show()}}}();var Editor=Editor||{};Editor.graph=function(){"use strict";var a=1,b=function(a,c){var d,e;if(c.push(a),questions[a].source_paths&&(e=questions[a].source_paths),e)for(var f=0;f<e.length;f+=1)e[f]&&-1===c.indexOf(e[f].d)&&b(e[f].d,c);return d=c},c=function(a,b){var c,e,f=parseInt(a.node.width,10),g=parseInt(a.node.height,10),h=parseInt(a.node.x,10)+Math.round(f/2,10),i=parseInt(a.node.y,10)+g,j=parseInt(b.node.width,10),k=parseInt(b.node.height,10),l=parseInt(b.node.x,10)+Math.round(j/2,10),m=parseInt(b.node.y,10);return 0>m-i?(c=d({x:h,y:i,w:f,h:g},{x:l,y:m,w:j,h:k}),e="bundle"):(c=[{x:h,y:i},{x:l,y:m}],e="linear"),{pathinfo:c,interpolate:e}},d=function(a,b){{var c,d,e,f,g,h;Math.abs(b.y-a.y)}return c={x:a.x,y:a.y},d={x:Math.round(a.x+2*a.w),y:a.y+2*a.h},e={x:Math.round(b.x+4*b.w),y:a.y},f={x:Math.round(b.x+2*b.w),y:b.y-2*b.h},g={x:b.x,y:b.y},h=[c,d,e,f,g]},e=function(a){var b,d,e,f,g,h,i,j,k,l,m,n=this.id,o=2,p=10,q=questions[n],r=q.text_id,s=q.source_paths,t=q.destination_paths,u=q.node.width,v=q.node.height,w=d3.select("#canvas").attr("width"),x=d3.select("#canvas").attr("height");a.x<0?a.x=0:a.x+u>=w&&(a.x=w-u),a.y<0?a.y=0:a.y+v>=x&&(a.y=x-v),a.x+=d3.event.dx,a.y+=d3.event.dy,d3.select(this).attr("x",a.x),d3.select(this).attr("y",a.y),questions[n].node.x=a.x,questions[n].node.y=a.y,d3.select("#"+r).attr("x",a.x+o),d3.select("#"+r).attr("y",a.y+p),l=function(a){return a.x},m=function(a){return a.y},j=s.length;for(var y=0;j>y;y+=1)null!==s[y]&&"undefined"!=typeof s[y]&&(b=s[y].pid,d=questions[s[y].d],e=c(q,d),
f=d3.svg.line().x(l).y(m).interpolate(e.interpolate),d3.select("#"+b).attr("d",f(e.pathinfo)));k=t.length;for(var z=0;k>z;z+=1)null!==t[z]&&"undefined"!=typeof t[z]&&(g=t[z].pid,h=questions[t[z].s],i=c(h,q),f=d3.svg.line().x(l).y(m).interpolate(i.interpolate),d3.select("#"+g).attr("d",f(i.pathinfo)))};return{populate:function(a){for(var b,c,d=100,e=20,f=0;a>f;f+=1)b=Editor.graph.getCounter(),c={_id:b,qid:"q"+b,step:"0",text_id:"qt"+b,question_text:"some question text",learn_more:{title:"what is my postal code",body:"look here for more info"},buttons:[],help:[],source_paths:[],destination_paths:[],fields:[],node:{x:d,y:e,width:40,height:40,fill:"#c6d5b0"}},e+=100,Editor.graph.addQuestion(c)},init:function(){var a,b,c=[],d=data();for(var e in d)d.hasOwnProperty(e)&&c.push(d[e]._id);c.sort(function(a,b){return a-b});for(var f=0;f<c.length;f+=1)b="q"+c[f],Editor.graph.addQuestion(d[b]);for(var g in d)if(d.hasOwnProperty(g)&&d[g].source_paths){a=d[g].source_paths.length;for(var h=0;a>h;h+=1)d[g].source_paths[h]&&Editor.graph.addPath(d[g].source_paths[h])}},convertJSON:function(a){var b=JSON.parse(a);Editor.graph.addQuestion(b)},addQuestion:function(a){var b=a.qid,c=a._id,d=a.text_id,f=d3.behavior.drag().origin(Object).on("drag",e),g=a.node.x,h=a.node.y,i=a.node.width,j=a.node.height,k=a.node.fill,l=2,m=10;return questions[b]={_id:c,qid:b,name:a.name,step:a.step,text_id:d,question_text:a.question_text,loop1:a.loop1,loop2:null,learn_more:a.learn_more,buttons:a.buttons,help:a.help,source_paths:[],destination_paths:[],fields:a.fields,advanced:a.advanced,node:{x:g,y:h,width:i,height:j,fill:k}},canvas.append("rect").data([{qid:b,x:g,y:h,w:i,h:j}]).style("fill",k).attr("width",i).attr("id",b).attr("height",j).attr("x",g).attr("y",h).call(f).on("mousedown",function(){Editor.list.activateItem(b,!1,!0),Editor.thumbnail.buildThumbnail(b)}).on("dblclick",function(){Editor.list.activateItem(b,!1,!0),Editor.details.manager.showQuestionDetails(b)}),canvas.append("text").data([{qtid:d,x:g,y:h}]).attr("class","label").attr("id",d).attr("x",g+l).attr("y",h+m).attr("text-anchor","left").style("fill","#32382C").text(b),Editor.main.updateCurrentQuestion(b),Editor.main.setQuestionCount(c),b},createQuestion:function(){var a,b,c=Editor.main.getQuestionCount(),d=Editor.list.getActiveItem();return d||(d=Editor.main.getLastID()),a=questions[d],b={_id:c,qid:"q"+c,name:"Question Name "+c,step:a.step,text_id:"qt"+c,question_text:"",loop1:a.loop1,loop2:null,learn_more:{title:"",body:""},buttons:[{type:"continue",destination:"none",pid:null}],help:[],source_paths:[],destination_paths:[],fields:[],advanced:[],node:{x:a.node.x,y:a.node.y+a.node.height+5,width:40,height:40,fill:"#c6d5b0"}}},removeQuestion:function(a){var b,c,d,e,f,g,h=questions[a].source_paths,i=questions[a].destination_paths,j=questions[a].text_id,k=Editor.settings.getStart();b=h.length;for(var l=0;b>l;l+=1)null!==h[l]&&"undefined"!=typeof h[l]&&(d=h[l].s,f=h[l].pid,Editor.graph.deletePath(d,f));c=i.length;for(var m=0;c>m;m+=1)null!==i[m]&&"undefined"!=typeof i[m]&&(e=i[m].s,Editor.details.contents.buttons.removeOldRefs(e,a),Editor.details.contents.advanced.removeOldRefs(e,a),g=i[m].pid,Editor.graph.deletePath(e,g));if(d3.select("#"+a).remove(),d3.select("#"+j).remove(),delete questions[a],k===a)for(var n in questions)if(questions.hasOwnProperty(n)){Editor.settings.setStart(n);break}Editor.main.removeIDFromList(a)},addPath:function(a){var b,d,e=a.pid,f=a.s,g=a.d,h=a.stroke,i=a.stroke_width,j=(a.stroke_dasharray,c(questions[f],questions[g]));return d=d3.svg.line().x(function(a){return a.x}).y(function(a){return a.y}).interpolate(j.interpolate),b=Editor.graph.createPath(f,g,h,i,e),canvas.append("path").attr("d",d(j.pathinfo)).attr("id",b.pid).style("stroke",h).style("stroke-width",i).style("fill","none"),questions[f].source_paths.push(b),questions[g].destination_paths.push(b),Editor.main.setPathCount(b.pid),b.pid},createPath:function(a,b,c,d,e){var f,g;return(null===e||"undefined"==typeof e)&&(f=Editor.main.getPathCount(),e="p"+f),g={pid:e,s:a,d:b,stroke:c,stroke_width:d}},deletePath:function(a,b){var c,d,e;c=Editor.utils.findIndex("pid",b,questions[a].source_paths),d=questions[a].source_paths[c].d,e=Editor.utils.findIndex("pid",b,questions[d].destination_paths),d3.select("#"+b).remove(),delete questions[a].source_paths[c],delete questions[d].destination_paths[e]},moveNode:function(a,b,c){var d=a,e=questions[a].text_id,f=2,g=10;d3.select("#"+d).data([{x:b,y:c}]),d3.select("#"+d).attr("x",b),d3.select("#"+d).attr("y",c),d3.select("#"+e).attr("x",b+f),d3.select("#"+e).attr("y",c+g),questions[a].node.x=b,questions[a].node.y=c},movePaths:function(a){var b,d,e,f,g,h,i=questions[a];if(f=function(a){return a.x},g=function(a){return a.y},0!==i.source_paths.length)for(var j=0;j<i.source_paths.length;j+=1)null!==i.source_paths[j]&&"undefined"!=typeof i.source_paths[j]&&(b=questions[i.source_paths[j].d],d=c(i,b),e=i.source_paths[j].pid,h=d3.svg.line().x(f).y(g).interpolate(d.interpolate),d3.select("#"+e).attr("d",h(d.pathinfo)))},changePathDestination:function(a,b,d,e){var f,g,h,i,j=questions[b],k=questions[d],l=c(j,k);f=d3.svg.line().x(function(a){return a.x}).y(function(a){return a.y}).interpolate(l.interpolate),d3.select("#"+a).attr("d",f(l.pathinfo)),i=Editor.utils.findIndex("pid",a,questions[b].source_paths),h=Editor.utils.findIndex("pid",a,questions[e].destination_paths),questions[b].source_paths[i].d=d,g=questions[b].source_paths[i],delete questions[e].destination_paths[h],questions[d].destination_paths.push(g)},moveTo:function(b){var c=parseInt(d3.select("#"+b).data()[0].x*a,10),d=parseInt(d3.select("#"+b).data()[0].y*a,10);$("#container").scrollLeft(c-100).scrollTop(d-100)},scaleGraph:function(b){var c,d=.2;"scale-up"===b?1>=a&&(c=(parseFloat(a,10)+parseFloat(d,10)).toFixed(2),canvas.attr("transform"," scale("+c+")"),a=c):"scale-down"===b&&a>.2&&(c=(a-parseFloat(d,10)).toFixed(2),canvas.attr("transform"," scale("+c+")"),a=c)},orderGraph:function(){for(var a,c={},d=Editor.settings.getStart(),e=b(d,[]),f=0;f<e.length;f+=1)if(a=e[f],c[a]=[],0!==questions[a].source_paths.length)for(var g=0;g<questions[a].source_paths.length;g+=1)null!==questions[a].source_paths[g]&&"undefined"!=typeof questions[a].source_paths[g]&&c[a].push(questions[a].source_paths[g].d);for(var h in questions)if(questions.hasOwnProperty(h)&&(null===c[h]||"undefined"==typeof c[h])&&(c[h]=[],questions[h].source_paths))for(var i=0;i<questions[h].source_paths.length;i+=1)questions[h].source_paths[i]&&c[h].push(questions[h].source_paths[i].d);return{nodes:c,start:d}},cloneQuestion:function(a){var b=Editor.main.getQuestionCount(),c=$.extend(!0,{},questions[a]);if(c._id=b,c.qid="q"+b,c.text_id="qt"+b,c.source_paths=[],c.destination_paths=[],c.node.x=c.node.x+80,0!==c.buttons.length)for(var d=0;d<c.buttons.length;d+=1)(null!==c.buttons[d].pid||""!==c.buttons[d].pid)&&(c.buttons[d].destination="none",c.buttons[d].pid=null);if(0!==c.advanced.length)for(var e=0;e<c.advanced.length;e+=1)if(null!==c.advanced[e].actions&&"undefined"!=typeof c.advanced[e].actions)for(var f=0;f<c.advanced[e].actions.length;f+=1)"goto"===c.advanced[e].actions[f].action&&(c.advanced[e].actions[f].value="none",c.advanced[e].actions[f].pid=null);return Editor.graph.addQuestion(c)}}}();var questions={},Editor=Editor||{};Editor.details=Editor.details||{},Editor.details.contents=Editor.details.contents||{},Editor.details.contents.fields=Editor.details.contents.fields||{},window.onload=function(){Editor.socket.init(),Editor.menu.init(),Editor.graph.init(),Editor.list.init(),Editor.settings.init(),Editor.interview.init(),Editor.debug.init(),Editor.details.manager.init(),Editor.details.tabs.init(),Editor.details.contents.question.init(),Editor.details.contents.learnmore.init(),Editor.details.contents.fields.common.init(),Editor.details.contents.advanced.init(),Editor.details.contents.buttons.init()},window.onbeforeunload=function(){return null};var Editor=Editor||{};Editor.interview=function(){"use strict";var a=function(){var a=Editor.socket.getSocket();a.on("graph",function(a){var b;for(b in a)a.hasOwnProperty(b)&&Editor.graph.moveNode(b,a[b].x,a[b].y);for(b in a)a.hasOwnProperty(b)&&Editor.graph.movePaths(b);$("#container").scrollLeft(0).scrollTop(0)}),a.on("saved",function(a){$(".nf-pnd").remove(),a||alert("Saving is currently disabled. All changes have been discarded.")}),$("#m-preview-close").live("click",function(){b()})},b=function(){$("#w-preview").html(""),$("#m-preview").addClass("none"),Editor.debug.hideDebug(),Editor.debug.setActiveQuestion(null),Editor.thumbnail.showThumbnail(),Editor.main.closeWindow("preview"),Editor.menu.set()},c=function(){var a=Editor.socket.getSocket(),b={id:Editor.settings.getID(),data:questions,settings:Editor.settings.get()};$("body").prepend('<div class="nf-pnd">Saving ...</div>'),a.emit("save",b)};return{init:function(){a()},preview:function(a){var b=$("#w-preview"),d=Editor.settings.getID(),e=Editor.socket.getEditorID();c(),b.html(null!==a&&"undefined"!=typeof a?'<iframe src="/manager/interview/'+d+"/stage?preview=true&id="+e+"&start="+a+'"></iframe>':'<iframe src="/manager/interview/'+d+"/stage?preview=true&id="+e+'"></iframe>'),Editor.thumbnail.hideThumbnail(),Editor.debug.buildDebug(),Editor.debug.showDebug(),$("#m-preview").removeClass("none"),Editor.main.openWindow("preview"),Editor.menu.set()},graph:function(){var a=Editor.socket.getSocket(),b=Editor.graph.orderGraph();a.emit("graph",b)},save:function(){c()},closePreview:function(){b()}}}();var Editor=Editor||{};Editor.list=function(){"use strict";var a=null,b="sort-a",c=function(){$(".mli").live("click",function(){var a;Editor.main.getDetailsStatus()||(a=$(this).data("qid"),Editor.list.activateItem(a,!0,!1),Editor.thumbnail.buildThumbnail(a))}),$(".mli").live("dblclick",function(){var a=$(this).data("qid"),b=Editor.main.getCurrentQuestion(),c=Editor.main.getDetailsStatus();(a!==b||a===b&&c===!1)&&(Editor.list.activateItem(a,!0),Editor.details.manager.showQuestionDetails(a)),Editor.thumbnail.buildThumbnail(a)})},d=function(){for(var a,b=[],c=Editor.utils.sort("_id",function(a,b){return a.id-b.id}),d=0;d<c.length;d+=1)a="q"+c[d].id,b.push('<div data-qid="'+a+'" class="mli">'),b.push('<div class="list-qid">['+a+"]</div>"),b.push('<div class="list-step">'+questions[a].step+"</div>"),b.push('<div class="list-name">'+questions[a].name+"</div></div>");return b.join("")},e=function(){var a,b=[],c=Editor.settings.getSteps(),d=[],e=c.slice(0);e.push("none");for(var f=0;f<e.length;f+=1){d.push([]);for(var g in questions)if(questions.hasOwnProperty(g)&&(console.log(questions[g].step),console.log($("<div/>").html(e[f]).text()),questions[g].step===$("<div/>").html(e[f]).text()))if(0===d[f].length)d[f].push({name:questions[g].name,step:questions[g].step,qid:g});else{a=!1;for(var h=0;h<d[f].length;h+=1)if(questions[g].name.toUpperCase()<d[f][h].name.toUpperCase()){d[f].splice(h,0,{name:questions[g].name,step:questions[g].step,qid:g}),a=!0;break}a||d[f].push({name:questions[g].name,step:questions[g].step,qid:g})}}for(var i=0;i<d.length;i+=1)for(var j=0;j<d[i].length;j+=1)b.push('<div data-qid="'+d[i][j].qid+'" class="mli">'),b.push('<div class="list-step">'+d[i][j].step+"</div>"),b.push('<div class="list-name">'+d[i][j].name+"</div>"),b.push('<div class="list-qid">['+d[i][j].qid+"]</div></div>");return b.join("")},f=function(){for(var a,b=[],c=function(a,b){var c=a.value.toUpperCase(),d=b.value.toUpperCase();return d>c?-1:c>d?1:0},d=Editor.utils.sort("name",c),e=0;e<d.length;e+=1)a="q"+d[e].id,b.push('<div data-qid="'+a+'" class="mli">'),b.push('<div class="list-name">'+questions[a].name+"</div>"),b.push('<div class="list-qid">['+a+"]</div>"),b.push('<div class="list-step">'+questions[a].step+"</div>"),b.push("</div>");return b.join("")};return{init:function(){c(),$("#q-d-list").html(d())},getActiveItem:function(){return a},orderList:function(a,c){switch(a?b=a:a=b,a){case"sort-a":$("#q-d-list").html(d());break;case"sort-b":$("#q-d-list").html(e());break;case"sort-c":$("#q-d-list").html(f())}c&&Editor.list.activateItem(c,!1,!0)},activateItem:function(b,c){var d,e;b&&(d=$("#q-d-list"),null!==a&&(d.find("[data-qid='"+a+"']").removeClass("active"),d3.select("#"+a).style("fill","#c6d5b0"),d3.select("#qt"+a.substr(1)).style("fill","#32382C")),e=d.find("[data-qid='"+b+"']").addClass("active"),a=b,d3.select("#"+a).style("fill","#02779E"),d3.select("#qt"+a.substr(1)).style("fill","#fff"),c&&Editor.graph.moveTo(b))},removeItem:function(b){$("#q-d-list").find("[data-qid='"+b+"']").remove(),a=null}}}();var Editor=Editor||{};Editor.main=function(){"use strict";var a=null,b=null,c=!1,d=0,e=0,f=[],g=["graph"];return{getCurrentQuestion:function(){return a},getPreviousQuestion:function(){return b},getQuestionCount:function(){return d},getPathCount:function(){return e},getDetailsStatus:function(){return c},openWindow:function(a){var b=g.indexOf(a);0>b&&g.push(a)},closeWindow:function(a){var b=g.indexOf(a);b>=0&&g.splice(b,1)},getWindow:function(){return g},setQuestionCount:function(a){a=parseInt(a,10);var b="q"+a;f.push(b),a>d?d=a+1:d+=1},setPathCount:function(a){a=parseInt(a.substr(1),10),a>e?e=a+1:e+=1},updateCurrentQuestion:function(c){b=null===b?c:a,a=c},updateDetailsStatus:function(a){c=a},getIDList:function(){return f},getLastID:function(){return f[f.length-1]},removeIDFromList:function(a){var b=f.indexOf(a);-1!==b&&f.splice(b,1)}}}();var Editor=Editor||{};Editor.menu=function(){"use strict";var a={graph:{main:["save","add","remove","clone","sort-a","sort-b","sort-c","preview","settings","scale-up","scale-down","order"],sub:["home","save","tools","add","remove","sort-a","sort-b","sort-c","clone","preview","scale-up","scale-down","order"]},question:{main:["save","graph","preview","settings"],sub:["home","save","tools","preview","preview-q"]},settings:{main:["save","graph","preview"],sub:["preview"]},preview:{main:["graph","settings","edit-q"],sub:["edit-q"]}},b=function(){for(var a,b=Editor.main.getWindow().slice(),c=b.length;c>0;c-=1)if(a=b[c-1],"graph"!==a)switch(a){case"question":Editor.details.manager.closeQuestion();break;case"preview":Editor.interview.closePreview();break;case"settings":Editor.settings.closeSettings()}},c=function(){$(".fli").live("click",function(){var a,c,d,e,f=$(this).data("sub-menu-command");switch(f){case"settings":b(),Editor.settings.openSettings();break;case"preview":Editor.interview.preview();break;case"preview-q":d=Editor.main.getCurrentQuestion(),Editor.interview.preview(d);break;case"edit-q":a=Editor.debug.getActiveQuestion(),d=Editor.main.getCurrentQuestion(),Editor.interview.closePreview(),Editor.details.manager.showQuestionDetails(a||d);break;case"add":e=Editor.graph.createQuestion(),d=Editor.graph.addQuestion(e),Editor.list.orderList(null,d);break;case"remove":d=Editor.list.getActiveItem(),d&&(Editor.graph.removeQuestion(d),Editor.list.removeItem(d));break;case"sort-a":case"sort-b":case"sort-c":Editor.list.orderList(f,d);break;case"clone":c=Editor.list.getActiveItem(),c&&(d=Editor.graph.cloneQuestion(c),Editor.list.orderList(null,d));break;case"save":Editor.interview.save();break;case"scale-up":case"scale-down":Editor.graph.scaleGraph(f);break;case"order":Editor.interview.graph()}}),$(".mmli").live("click",function(){var a,c,d,e,f=$(this).data("main-menu-command");switch($("#main-menu-nav ul").css("display","none"),f){case"settings":b(),Editor.settings.openSettings();break;case"graph":b();break;case"preview":b(),Editor.interview.preview();break;case"save":Editor.interview.save();break;case"scale-up":case"scale-down":Editor.graph.scaleGraph(f);break;case"order":Editor.interview.graph();break;case"edit-q":a=Editor.debug.getActiveQuestion(),Editor.interview.closePreview(),Editor.details.manager.showQuestionDetails(a);break;case"add":e=Editor.graph.createQuestion(),d=Editor.graph.addQuestion(e),Editor.list.orderList(null,d);break;case"remove":d=Editor.list.getActiveItem(),d&&(Editor.graph.removeQuestion(d),Editor.list.removeItem(d));break;case"sort-a":case"sort-b":case"sort-c":Editor.list.orderList(f,d);break;case"clone":c=Editor.list.getActiveItem(),c&&(d=Editor.graph.cloneQuestion(c),Editor.list.orderList(null,d))}}),$("#main-menu-nav > li").mouseenter(function(){$("#main-menu-nav ul").css("display","none"),$(this).find("ul").show()}),$("#main-menu-nav ul, #main-menu-nav > li").not().mouseleave(function(){$("#main-menu-nav ul").hide()}),document.addEventListener("keydown",function(a){83===a.keyCode&&(navigator.platform.match("Mac")?a.metaKey:a.ctrlKey)&&(a.preventDefault(),Editor.interview.save())},!1)},d=function(){$(".main-menu").each(function(){$(this).hasClass("disabled")&&($(this).removeClass("disabled"),$(this).addClass("mmli"))}),$(".sub-menu").each(function(){var a=$(this).data("sub-menu-command");$(this).hasClass(a+"-disabled")&&($(this).removeClass(a+"-disabled"),$(this).addClass("fli "+a))})};return{init:function(){c()},set:function(){var b=Editor.main.getWindow(),c=b[b.length-1];d(),$(".main-menu").each(function(){var b=$(this).data("main-menu-command");-1===a[c].main.indexOf(b)&&($(this).removeClass("mmli"),$(this).addClass("disabled"))}),$(".sub-menu").each(function(){var b=$(this).data("sub-menu-command");-1===a[c].sub.indexOf(b)&&($(this).removeClass("fli "+b),$(this).addClass(b+"-disabled"))})}}}();var Editor=Editor||{};Editor.settings=function(){"use strict";var a=null,b="",c="",d="",e="",f=[],g=["#18C27A","#FA0530","#D3C015","#FAE79F","#0B5B70","#4FADD3","#FD6B0E","#C1D7E1","#FE548F","#9061C2","#1A20BA","#0C3F4E","#A8D26E","#A74143","#F6F31B"],h=function(a){var b=[];b.push('<select id="settings-start-dd">');for(var c in questions)questions.hasOwnProperty(c)&&b.push(questions[c].qid===a?'<option selected="selected">'+questions[c].qid+"</option>":"<option>"+questions[c].qid+"</option>");return b.push("</select>"),b.join("")},i=function(a){for(var b,c=[],d=0;d<a.length;d+=1)a[d]&&(b=d+1,c.push('<div data-step-index="'+d+'" style="color:'+g[d%15]+'" class="settings-steps-list-i">'+b+": "+a[d]+"</div>"));return c.join("")},j=function(a){var b=[];return b.push('<div id="settings-steps-list">'),b.push(i(a)),b.push("</div>"),b.push('<div class="clear"></div>'),b.push('<ul class="s-list-controls">'),b.push('<li data-s-cmd="add" class="add unselectable sia">Add</li>'),b.push('<li data-s-cmd="remove" class="remove unselectable sia">Remove</li>'),b.push("</ul>"),b.push('<div class="clear"></div>'),b.push('<div id="settings-steps-list-item-new"></div>'),b.join("")},k=function(){var a=[];return a.push('<textarea id="settings-s-item-ta" class=""text-area-def></textarea>'),a.push('<div class="clear"></div>'),a.push('<ul class="s-item-controls">'),a.push('<li data-s-item-cmd="checkmark" class="checkmark unselectable siia">OK</li>'),a.push('<li data-s-item-cmd="delete" class="delete unselectable siia">Cancel</li>'),a.push("</ul>"),a.push('<div class="clear"></div>'),a.join("")},l=function(){$("#m-settings").addClass("none"),Editor.main.closeWindow("settings"),Editor.menu.set()},m=function(){$("#m-settings-close").live("click",function(){l()}),$(".sia").live("click",function(){var b,c=$(this).data("s-cmd");if("add"===c)$(".s-list-controls").hide(),$("#settings-steps-list-item-new").html(k());else if("remove"===c&&null!==a){for(var d in questions)questions.hasOwnProperty(d)&&questions[d].step===f[a]&&(questions[d].step="none");b=$("#settings-steps-list"),Editor.settings.deleteStep(a),b.html(i(f)),a=null}}),$(".siia").live("click",function(){var a,b=$(this).data("s-item-cmd");"checkmark"===b?(a=$("#settings-s-item-ta").val(),a=$.trim(a),a&&(Editor.settings.insertStep(a),$("#settings-steps-container").html(j(f)))):"delete"===b&&$("#settings-steps-container").html(j(f))}),$(".settings-steps-list-i").live("click",function(){var b=$(this).data("step-index");null!==a&&$("#settings-steps-list").find("[data-step-index='"+a+"']").removeClass("active"),a=b,$(this).addClass("active")}),$("#settings-start-dd").live("change",function(){Editor.main.getCurrentQuestion();e=$(this).val()})};return{init:function(){m()},set:function(a,g,h,i,j){b=a,c=g,d=h,e=i,f=JSON.parse(j)},get:function(){return{id:b,name:c,description:d,start:e,steps:f}},getID:function(){return b},getStart:function(){return e},setStart:function(a){e=a},getSteps:function(){return f},insertStep:function(a){f.push(a)},deleteStep:function(a){var b=[];delete f[a];for(var c=0;c<f.length;c+=1)f[c]&&b.push(f[c]);f=b},buildSettings:function(){$("#settings-name").html(c),$("#settings-description").html(d),$("#settings-start-container").html(h(e)),$("#settings-steps-container").html(j(f))},closeSettings:function(){l()},openSettings:function(){Editor.settings.buildSettings(),$("#m-settings").removeClass("none"),Editor.main.openWindow("settings"),Editor.menu.set()}}}();var Editor=Editor||{};Editor.socket=function(){"use strict";var a,b=null;return{init:function(){a=io.connect(BASE_URL),a.on("connect",function(){b=(Date.now()+(Math.floor(1e5*Math.random())+2)).toString(),a.emit("editor_id",b)}),a.on("connect_failed",function(){}),a.on("disconnect",function(){})},getEditorID:function(){return b},getSocket:function(){return a}}}();var Editor=Editor||{};Editor.thumbnail=function(){"use strict";var a=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n=[];if(n.push('<div class="aux-thumb-xtra"><span class="bold">['+a.qid+'] </span><span class="">'+a.name+'</span></div><div class="clear"></div><br>'),n.push('<div class="aux-thumb-xtra"><table class="thumbnail-table"><thead><tr><th>Question</th></tr></thead><tr><td style="background:#f0f0f0">'),n.push('<div class="contents">'),n.push('<div class="prompt">'),n.push('<div class="text">'+a.question_text+"</div>"),a.fields)for(var o=0;o<a.fields.length;o+=1){switch(b=a.fields[o],c="var-label",d=b.name,e=b.label,f=b.type,g=b.def,h=b.validation,i=b.values,j="",n.push('<div class="var-container">'),e&&(c="yes"===h.required||"yes"===h.nota?"var-label required":"var-label",n.push('<div class="'+c+'">'+e+"</div>")),f){case"text":n.push(null!==g&&void 0!==typeof g&&""!==g?'<ul><li><input type="text" value="'+g.replace(/"/g,"&quot;")+'" size="40" class="textbox" readonly="readonly" /></li></ul>':'<ul><li><input type="text" size="40" class="textbox" readonly="readonly" /></li></ul>');break;case"textarea":n.push(null!==g&&void 0!==typeof g&&""!==g?'<ul><li><textarea cols="34" rows="5" class="textarea" readonly="readonly" >'+g+"</textarea></li></ul>":'<ul><li><textarea cols="34" rows="5" class="textarea" readonly="readonly" ></textarea></li></ul>');break;case"number":n.push(null!==g&&void 0!==typeof g&&""!==g?'<ul><li><input type="text" value="'+g.replace(/"/g,"&quot;")+'" size="40" class="textbox" readonly="readonly" /></li></ul>':'<ul><li><input type="text" size="40" class="textbox" readonly="readonly" /></li></ul>');break;case"radio":if(i){n.push('<ul class="radio-list">');for(var p=0;p<i.length;p+=1)n.push("<li>"),n.push(j===i[p].id?'<input type="radio" name="'+d+'" checked="checked" />':'<input type="radio" name="'+d+'" />'),n.push("<label>"+i[p].label+"</label>"),n.push("</li>");n.push("</ul>")}break;case"date":n.push("<ul>"),n.push('<li><input type="text" size="14" class="datepicker-textbox" readonly="readonly" /></li>'),n.push("</ul>");break;case"checkbox":if(i){n.push('<ul id="'+d+":"+f+'" class="id-field checkbox-list">');for(var q=0;q<i.length;q+=1)n.push("<li>"),n.push("yes"===h.nota?j===i[q].id?'<input type="checkbox" checked="checked" class="id-cb" />':'<input type="checkbox" class="id-cb" />':j===i[q].id?'<input type="checkbox" checked="checked" class="id-test" />':'<input type="checkbox" class="id-test" />'),n.push("<label>"+i[q].label+"</label>"),n.push("</li>");"yes"===h.nota&&n.push('<li><input type="checkbox" id="id-nota" class="id-cb" /><label>None of the above</label></li>'),n.push("</ul>")}break;case"text_dropdown":if(i){if(n.push('<ul class="dropdown-list">'),n.push("<li>"),n.push('<select class="dropdown">'),null!==g&&void 0!==g&&""!==g){n.push('<option value="">none</option>');for(var r=0;r<i.length;r+=1)n.push(g===i[r].id?'<option selected="selected">'+i[r].label+"</option>":"<option>"+i[r].label+"</option>")}else{n.push('<option value="" selected="selected">none</option>');for(var s=0;s<i.length;s+=1)n.push('<option value="'+i[s].id+'">'+i[s].label+"</option>")}n.push("</select>"),n.push("</li>"),n.push("</ul>")}break;case"number_dropdown":if(null!==b.start&&"undefined"!=typeof b.start&&""!==b.start&&null!==b.end&&"undefined"!=typeof b.end&&""!==b.end){if(n.push('<ul class="dropdown-list">'),n.push("<li>"),n.push('<select class="dropdown">'),l=Math.max(b.start,b.end),k=Math.min(b.start,b.end),m=b.descending,null!==g&&"undefined"!=typeof g&&""!==g){n.push('<option value="">none</option>');var t;if("yes"===m)for(t=l;t>=k;t-=1)n.push(g===t.toString()?'<option selected="selected">'+t+"</option>":"<option>"+t+"</option>");else for(t=k;l>=t;t+=1)n.push(g===t.toString()?'<option selected="selected">'+t+"</option>":"<option>"+t+"</option>")}else{n.push('<option value="" selected="selected">none</option>');var u;if("yes"===m)for(u=l;u>=k;u-=1)n.push("<option>"+u+"</option>");else for(u=k;l>=u;u+=1)n.push("<option>"+u+"</option>")}n.push("</select>"),n.push("</li>"),n.push("</ul>")}}n.push("</div>")}if(n.push("</div>"),n.push('<div class="clear"></div>'),n.push("</div>"),n.push("</td></tr></table></div>"),n.push('<div class="clear"></div>'),n.push('<div class="aux-thumb-xtra">'),a.buttons){n.push('<table class="thumbnail-table"><thead><tr><th colspan="2">Buttons</th></tr></thead>');for(var v=0;v<a.buttons.length;v+=1)n.push('<tr><td><span class="bold">'+a.buttons[v].type+"</span></td><td>"+a.buttons[v].destination+"</td></tr>");n.push("</table>")}if(a.loop1&&n.push('<table class="thumbnail-table"><thead><tr><th>Loop</th></tr></thead><tr><td><span class="bold">'+a.loop1+"</span></td></tr></table>"),0!==a.fields.length){n.push('<table class="thumbnail-table"><thead><tr><th>Fields</th></tr></thead>');for(var w=0;w<a.fields.length;w+=1)n.push("yes"===a.fields[w].validation.required?'<tr><td><code class="red"><strong>'+a.fields[w].name+"</strong></code></td></tr>":"<tr><td><code>"+a.fields[w].name+"</code></td></tr>");n.push("</table>")}if(0!==a.advanced.length){n.push('<table class="thumbnail-table"><thead><tr><th>Advanced</th></tr></thead>');for(var x=0;x<a.advanced.length;x+=1)if(n.push('<tr><td><div class="thumb-adv-c">'+a.advanced[x].event+"</div><code>"+a.advanced[x].condition+"</code>"),a.advanced[x].actions){for(var y=0;y<a.advanced[x].actions.length;y+=1)n.push("goto"===a.advanced[x].actions[y].action?'<div class="thumb-adv-action-'+a.advanced[x].actions[y]["if"].toString()+'">goto '+a.advanced[x].actions[y].value+"</div>":'<div class="thumb-adv-action-'+a.advanced[x].actions[y]["if"].toString()+'">set '+a.advanced[x].actions[y].name+" = "+a.advanced[x].actions[y].value+"</div>");n.push("</td></tr>")}n.push("</table>")}return n.push("</div>"),n.join("")};return{buildThumbnail:function(b){$("#thumbnail").html(a(questions[b]))},showThumbnail:function(){$("#thumbnail").removeClass("none")},hideThumbnail:function(){$("#thumbnail").addClass("none")}}}();var Editor=Editor||{};Editor.utils=function(){"use strict";return{findIndex:function(a,b,c){for(var d=0;d<c.length;d+=1)if(null!==c[d]&&"undefined"!=typeof c[d]&&c[d][a]===b)return d;return-1},cleanInput:function(a){a.trim()},rebuildArray:function(a){for(var b=[],c=0;c<a.length;c+=1)null!==a[c]&&"undefined"!=typeof a[c]&&b.push(a[c]);return b},sort:function(a,b){var c=[];for(var d in questions)questions.hasOwnProperty(d)&&c.push({id:questions[d]._id,value:questions[d][a]});return b?c.sort(b):c.sort(),c},deepCopy:function(a){var b,c={};for(var d in a)a.hasOwnProperty(d)&&(b=a[d],c[d]="object"==typeof b&&null!==b?Editor.utils.deepCopy(b):b);return c}}}();var Editor=Editor||{};Editor.validation=function(){"use strict";return{condition:function(a){return 0!==a.length?a.match(/^[a-zA-Z0-9_#%&!=+.?;<>|\,\$\:\[\]\'\"\-\/\)\(\*\s]*$/):!0},date:function(){return!0},number:function(a){return 0!==a.length?a.match(/^(?:[1-9]\d*|0)?(?:\.\d+)?$/):!0},integer:function(a){return 0!==a.length?a.match(/^\d+$/):!0},alphanum:function(a){return 0!==a.length?a.match(/^[a-zA-ZA-0-9]+$/):!0},label:function(a){return 0!==a.length?a.match(/^[a-zA-ZA-0-9,:._#'"?$<>\-%&\\\/\)\(\*\s]*$/):!0},alphadash:function(a){return 0!==a.length?a.match(/^[a-zA-ZA-\-]*$/):!0},variable:function(a){return 0!==a.length?a.match(/^[a-zA-Z][a-zA-Z0-9_\[\]]+$/):!0},required:function(a){return 0===a.length?!1:!0},check:function(a,b){for(var c,d=0;d<b.length;d+=1)if("object"==typeof b[d]){if(Editor.validation[Object.keys(b[d])[0]]&&(c=b[d][Object.keys(b[d])[0]],!Editor.validation[Object.keys(b[d])[0]](a,c)))return!1}else if(Editor.validation[b[d]]&&!Editor.validation[b[d]](a))return!1;return!0}}}();