/*! LogicPull 0.9.15 2017-01-29 */
var Viewer=Viewer||{};Viewer.socket=function(){"use strict";var a,b=null,c=!0,d=function(a){a=a.replace(/[\[]/,"\\\\[").replace(/[\]]/,"\\\\]");var b="[\\?&]"+a+"=([^&#]*)",c=new RegExp(b),d=c.exec(window.location.search);return null===d?"":decodeURIComponent(d[1].replace(/\+/g," "))};return{init:function(){a=io.connect(BASE_URL),a.on("connect",function(){if(c){var e=null,f=null;c=!1,window.location.search&&(e=d("preview"),b=d("id"),f=d("start"),a.emit("editor_id",b));var g=$("#interview-id").html();g&&a.emit("start",{interview_id:g,start:f,preview:e})}}),a.on("question",function(a){Viewer.interview.setFinishGate(!0),Viewer.interview.setCompleteGate(!0),Viewer.interview.setContinueGate(!0),Viewer.interview.setPartialGate(!0),Viewer.interview.setInterviewID(a.id),$(".btn").button("reset"),a.valid?(a.partial&&$("#open-saves").modal("hide"),Viewer.interview.question(a.data.question,a.data.fields),Viewer.interview.progress(a.data.progress),Viewer.interview.fraction(a.data.fraction),Viewer.interview.setCurrentQID(a.qid)):($("#"+a.data.name+"-var-container").hasClass("var-error")||$("#"+a.data.name+"-var-container").addClass("var-error"),alert(a.data.message))}),a.on("saved_progress",function(a){Viewer.interview.saved(!0),a.valid?$("#save-interview").modal("hide"):alert("Your interview could not be saved at this time. Please try again.")}),a.on("open_saved",function(a){a.valid?($("#saves-data-payload").html(a.data),$("#open-saves").modal()):alert("There was a problem retrieving your saved interviews. Please try again.")}),a.on("process_saved",function(a){a.valid?alert("The saved interview was processed successfully."):alert("There was a problem processing your saved interview. Please try again.")}),a.on("insert_saved_note",function(a){$("textarea[name=t-d-note]").val(a.note),$("input[name=t-d-name]").val(a.name)}),a.on("srv_error",function(a){Viewer.interview.question({content:a.error})})},getSocket:function(){return a}}}(),Viewer.interview=function(){"use strict";var a=!0,b=!0,c=null,d=null,e=!0,f=!0,g=!0,h=!0,i=function(){var i,j;$("#save").click(function(){var a=Viewer.socket.getSocket();b&&c&&(j="save",a.emit("get_saved_note",{id:c}),$.ajax({type:"GET",url:BASE_URL+"/admin/post/status?d="+(new Date).getTime(),dataType:"json",cache:!1,success:function(a){a.logged_in?$("#save-interview").modal():$("#login-register").modal()},error:function(a,b,c){alert(b)}}))}),$("#open").click(function(a){Viewer.socket.getSocket();b&&c&&(j="open",$.ajax({type:"GET",url:BASE_URL+"/admin/post/status?d="+(new Date).getTime(),dataType:"json",cache:!1,success:function(a){if(a.logged_in){var b,d,e;b=Viewer.socket.getSocket(),e=$("#interview-id").html(),d={id:c,interview:e},b.emit("open_saves",d)}else $("#login-register").modal()},error:function(a,b,c){alert(b)}}))}),$("#back").click(function(){var b,d,e,f,g,h=document.getElementById("progress");a&&c&&h.options&&h.options[h.selectedIndex]&&(d=h.options[h.selectedIndex].value,e=d.split(":"),"0"!==e[1]&&(b=Viewer.socket.getSocket(),f=$("#interview-id").html(),g={id:c,interview:f,backid:d,previd:null},b.emit("back",g),a=!1))}),$("body").on("click",".partial-sav-int",function(){if(h&&c){var a=$("#interview-id").html(),b=this.id,d=$(this).html(),e=Viewer.socket.getSocket(),f={id:c,interview:a,qid:d,partial_id:b};e.emit("load_saved",f),h=!1}}),$("body").on("click",".partial-process-int",function(){var a=$("#interview-id").html(),b=this.id,d=Viewer.socket.getSocket(),e={id:c,interview:a,partial_id:b};d.emit("process_saved",e)}),$("body").on("click",".youtube-modal",function(){var a=$(this).data("target"),b=$(a).find(".embed-responsive").first(),c=$(this).attr("href");return b.html('<iframe src="'+c+'" frameborder="0" allowfullscreen></iframe>'),$(a).modal(),!1}),$("body").on("click",".button",function(){if(g&&c){var a=($(".text"),$("#interview-id").html()),b=$(this).data("qid"),d=$(this).data("destination"),e=Viewer.socket.getSocket(),f={id:c,destination:d,interview:a,qid:b,fields:Viewer.interview.collectFieldData(b)};$(this).button("loading"),g=!1,e.emit("question",f)}}),$("body").on("click","#ltf-login-btn",function(a){$(this).button("loading"),a.preventDefault();var b=$("#ltf-login").serialize();return $.ajax({type:"POST",url:BASE_URL+"/admin/ltf_login?d="+(new Date).getTime(),data:b,dataType:"json",cache:!1,success:function(a){if($("#ltf-login-btn").button("reset"),a.error)$("#sf-g-error").html(a.msg).show();else if($("#login-register").modal("hide"),$("#sf-g-error").hide(),$("#ltf-login").find("input:text, input:password").val(""),"open"===j){var b=Viewer.socket.getSocket(),d=$("#interview-id").html(),e={id:c,interview:d};b.emit("open_saves",e)}else $("#save-interview").modal()},error:function(a,b,c){alert(b)}}),!1}),$("body").on("click","#ltf-register-btn",function(a){$(this).button("loading"),a.preventDefault();var b=$("#ltf-register").serialize();return $.ajax({type:"POST",url:BASE_URL+"/admin/ltf_register?d="+(new Date).getTime(),data:b,dataType:"json",cache:!1,success:function(a){if($("#ltf-register-btn").button("reset"),a.error)$("#sf-h-error").html(a.msg).show();else if($("#login-register").modal("hide"),$("#sf-h-error").hide(),$("#ltf-register").find("input:text, input:password").val(""),"open"===j){var b=Viewer.socket.getSocket(),d=$("#interview-id").html(),e={id:c,interview:d};b.emit("open_saves",e)}else $("#save-interview").modal()},error:function(a,b,c){alert(b)}}),!1}),$("body").on("click","#vfh-save",function(){if(b){var a=Viewer.socket.getSocket(),e=$("#interview-id").html(),f={id:c,qid:d,name:$.trim($("input[name=t-d-name]").val()),note:$.trim($("textarea[name=t-d-note]").val()),interview:e,fields:Viewer.interview.collectFieldData(d)};a.emit("save_progress",f),b=!1}}),$("body").on("click","#finish-interview",function(){if(e&&c){var a=$("#interview-id").html(),d=$(this).data("qid"),f=Viewer.socket.getSocket(),g={id:c,interview:a,qid:d,fields:Viewer.interview.collectFieldData(d)};$(this).button("loading"),e=!1,b=!1,f.emit("finish",g)}}),$("body").on("click","#exit-interview",function(){window.location.replace(BASE_URL)}),$("body").on("click","#complete-interview",function(){if(f){var a=$("#interview-id").html(),b=Viewer.socket.getSocket(),d={id:c,interview:a,email:$.trim($("input[name=q-final]").val())};$(this).button("loading"),f=!1,b.emit("send",d)}}),$("#progress").focus(function(){var a=document.getElementById("progress");a.options&&a.options[a.selectedIndex]&&(i=a.options[a.selectedIndex].value)}).change(function(){var b=document.getElementById("progress");if(b.options&&c&&b.options[b.selectedIndex]){var d=b.options[b.selectedIndex].value,e=Viewer.socket.getSocket(),f=$("#interview-id").html(),g={id:c,interview:f,backid:d,previd:i};e.emit("back",g),a=!1}}),$("body").on("click",".id-field",function(){var a=this.id.split(":"),b=a[0],c=$("#"+b+"-var-container");c.hasClass("var-error")&&c.removeClass("var-error")}),$("body").on("click",".id-cb",function(){var a=this.id.split("-")[0];$("#"+a+"-nota").is(":checked")&&$("#"+a+"-nota").prop("checked",!1)}),$("body").on("click","input[id$='-nota']",function(){var a=this.id.split("-")[0];$(".id-cb[name='"+a+"']").each(function(a){$(this).is(":checked")&&$(this).prop("checked",!1)}),$(this).prop("checked",!0)}),$("body").on("click",".text a, .learnmore a, .help-modal a",function(a){var b=$(this).prop("href");return $(this).attr("data-target")?void 0:(window.open(b),a.preventDefault(),!1)}),$("body").on("keyup","textarea",function(a){var b=$(this).val().length,c=$(this).data("max-length");if(c){var d=c-b,e="<span>"+d+" character(s) left</span>";$(this).next(".character-count").html(e),0>d&&$(".character-count span").addClass("text-danger")}})};return{init:function(){Viewer.socket.init(),i()},collectFieldData:function(a){var b=[];return $(".id-field").each(function(c){var d,e=this.id.split(":"),f=e[0],g=e[1];switch(g){case"text":d=$.trim($("input[name="+f+"]").val());break;case"textarea":d=$.trim($("textarea[name="+f+"]").val());break;case"number":d=$.trim($("input[name="+f+"]").val());break;case"radio":d=$.trim($("input[name="+f+"]:checked").val());break;case"date":d=$.trim($("#"+f+"_picker").datepicker().val());break;case"checkbox":d=[],$(".id-test").each(function(a){$(this).is(":checked")&&d.push($.trim($(this).val()))});break;case"text_dropdown":d=$("select[name="+f+"]").val();break;case"number_dropdown":d=$("select[name="+f+"]").val()}b.push({qid:a,name:f,section:"field",type:g,answer:d})}),b},populateFieldData:function(a){for(var b=0;b<a.length;b+=1)switch(a[b].type){case"text":case"number":$("input[name="+a[b].name+"]").val(a[b].answer);break;case"textarea":$("textarea[name="+a[b].name+"]").val(a[b].answer);break;case"radio":var c=a[b].answer;c&&$("input[name="+a[b].name+"][value="+c+"]").prop("checked",!0);break;case"date":$("#"+a[b].name+"_picker").datepicker().val(a[b].answer);break;case"checkbox":var d=a[b].answer;if(d)for(var e=0;e<d.length;e+=1)$("input[name="+a[b].name+"][value="+d[e]+"]").prop("checked",!0);console.log(a[b]);break;case"text_dropdown":case"number_dropdown":$("select[name="+a[b].name+"]").val(a[b].answer)}},question:function(b,c){$("#question").fadeOut("fast",function(){$(this).empty().html(b.content),$(this).fadeIn("fast",function(){}),b.date_pickers&&Viewer.interview.datePicker(b.date_pickers),c&&Viewer.interview.populateFieldData(c),a=!0}),$(".learnmore").fadeOut("fast",function(){$(this).empty().html(b.learnmore),$(this).fadeIn("fast")})},progress:function(a){$("#progress").html(a)},fraction:function(a){$("#fraction").html(a)},saved:function(a){b=!0},datePicker:function(a){if(a)for(var b,c=0;c<a.length;c+=1){b=$("#"+a[c].name+"_picker"),b.datepicker(),b.datepicker("option","changeMonth",!0),b.datepicker("option","changeYear",!0),b.datepicker("option","yearRange","1900:2100"),a[c].format&&b.datepicker("option","dateFormat",a[c].format);for(var d in a[c].validation)a[c].validation.hasOwnProperty(d)&&("min_date"===d?b.datepicker("option","minDate",a[c].validation[d]):"max_date"===d&&("TODAY"===a[c].validation[d].toUpperCase()?b.datepicker("option","maxDate","0"):b.datepicker("option","maxDate",a[c].validation[d])));a[c].def&&("TODAY"===a[c].def.toUpperCase()?b.datepicker("option","defaultDate",null):b.datepicker("option","defaultDate",a[c].def)),null!==a[c].set&&b.datepicker("setDate",a[c].set),$(".ui-datepicker").addClass("notranslate")}},setContinueGate:function(a){g=a},setPartialGate:function(a){h=a},setFinishGate:function(a){e=a},setCompleteGate:function(a){f=a},setInterviewID:function(a){c=a},setCurrentQID:function(a){d=a}}}();