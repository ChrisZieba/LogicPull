/*! LogicPull 0.8.12 2014-10-29 */
var Viewer=Viewer||{};Viewer.socket=function(){"use strict";var a,b=null,c=!0,d=function(a){a=a.replace(/[\[]/,"\\\\[").replace(/[\]]/,"\\\\]");var b="[\\?&]"+a+"=([^&#]*)",c=new RegExp(b),d=c.exec(window.location.search);return null===d?"":decodeURIComponent(d[1].replace(/\+/g," "))};return{init:function(){a=io.connect(BASE_URL),a.on("connect",function(){if(c){var e=null,f=null;c=!1,window.location.search&&(e=d("preview"),b=d("id"),f=d("start"),a.emit("editor_id",b));var g=$("#interview-id").html();g&&a.emit("start",{interview_id:g,start:f,preview:e})}}),a.on("question",function(a){Viewer.interview.setFinishGate(!0),Viewer.interview.setCompleteGate(!0),Viewer.interview.setContinueGate(!0),Viewer.interview.setPartialGate(!0),Viewer.interview.setInterviewID(a.id),$(".continue-button").css("background-position","-298px -8px"),$(".finish-button").css("background-position","-432px -8px"),$(".loading").remove(),a.valid?(a.partial&&$("#saves-container").is(":visible")&&$("#saves-container").hide(),Viewer.interview.question(a.data.question),Viewer.interview.progress(a.data.progress),Viewer.interview.fraction(a.data.fraction),Viewer.interview.setCurrentQID(a.qid)):($("#"+a.data.name+"-var-container").hasClass("var-error")||$("#"+a.data.name+"-var-container").addClass("var-error"),alert(a.data.message))}),a.on("saved_progress",function(a){Viewer.interview.saved(!0),a.valid?$("#note-container").hide():alert("Your interview could not be saved at this time. Please try again.")}),a.on("open_saved",function(a){a.valid?($("#saves-container #data-payload").html(a.data),$("#saves-container").show()):alert("There was a problem retrieving your saved interviews. Please try again.")}),a.on("insert_saved_note",function(a){$("textarea[name=t-d-note]").val(a.note)}),a.on("srv_error",function(a){Viewer.interview.question({content:a.error})}),a.on("reconnect",function(){}),a.on("connect_failed",function(){}),a.on("error",function(){}),a.on("connect_failed",function(){}),a.on("reconnect_failed",function(){}),a.on("disconnect",function(){})},getSocket:function(){return a}}}(),Viewer.interview=function(){"use strict";var a=!0,b=!0,c=null,d=null,e=!0,f=!0,g=!0,h=!0,i=function(){var i,j;$(".help-tooltip, .field-tooltip").live("click",function(){var a=$(this).children(".pointer"),b=$(this).children(".body"),c=$(".contents .prompt"),d=c.offset(),e=Math.round($(this).offset().left+$(this).width()/2-b.width()/2);a.css("left",Math.round($(this).width()/2)-14).toggle(),e<d.left?b.css("left","0px"):parseInt(e+b.width(),10)>parseInt(d.left+c.width(),10)?b.css("left","-"+Math.round(b.width()-65)+"px"):b.css("left",Math.round($(this).width()/2-b.width()/2)),"visible"===b.css("visibility")?b.css({visibility:"hidden"}):b.css({visibility:"visible"})}),$(".lm-display, .lm-data").live("click",function(){var a=$(".lm-data");a.is(":hidden")?a.show():a.hide()}),$(".youtube-popout").live("click",function(){var a=$("#youtube-container .popup"),b=$(this).find(".video-link a:first").attr("href"),c=a.width(),d=a.height();"440"===c?d="248":"280"===c&&(d="158"),a.html('<iframe width="'+c+'" height="'+d+'" src="'+b+'" frameborder="0" allowfullscreen></iframe>'),$("#youtube-container").show()}),$("#save").click(function(){var a=Viewer.socket.getSocket();b&&(j="save",a.emit("get_saved_note",{id:c}),$.ajax({type:"GET",url:BASE_URL+"/interviews/post/status?d="+(new Date).getTime(),dataType:"json",cache:!1,success:function(a){a.logged_in?$("#note-container").show():$("#login-container").show()},error:function(a,b){alert(b)}}))}),$("#open").click(function(){Viewer.socket.getSocket(),b&&(j="open",$.ajax({type:"GET",url:BASE_URL+"/interviews/post/status?d="+(new Date).getTime(),dataType:"json",cache:!1,success:function(a){if(a.logged_in){var b,d,e;b=Viewer.socket.getSocket(),e=$("#interview-id").html(),d={id:c,interview:e},b.emit("open_saves",d)}else $("#login-container").show()},error:function(a,b){alert(b)}}))}),$("#back").click(function(){var b,d,e,f,g,h=document.getElementById("progress");a&&h.options&&h.options[h.selectedIndex]&&(d=h.options[h.selectedIndex].value,e=d.split(":"),"0"!==e[1]&&(b=Viewer.socket.getSocket(),f=$("#interview-id").html(),g={id:c,interview:f,backid:d,previd:null},b.emit("back",g),a=!1))}),$("#l-d-close").live("click",function(){$("#login-container").is(":visible")&&$("#login-container").hide()}),$("#s-d-close").live("click",function(){$("#saves-container").is(":visible")&&$("#saves-container").hide()}),$("#t-d-close").live("click",function(){$("#note-container").is(":visible")&&$("#note-container").hide()}),$("#y-d-close").live("click",function(){$("#youtube-container").is(":visible")&&($("#youtube-container .popup iframe").hide(),$("#youtube-container .popup").empty().html("<span></span>"),$("#youtube-container").hide())}),$(".partial-sav-int").live("click",function(){if(h){var a=$("#interview-id").html(),b=this.id,d=$(this).html(),e=Viewer.socket.getSocket(),f={id:c,interview:a,qid:d,partial_id:b};e.emit("load_saved",f),$("#partial-loading-msg").show(),h=!1}}),$(".button").live("click",function(){if(g){$(".text");var a=$("#interview-id").html(),b=$(this).html(),d=Viewer.socket.getSocket(),e={id:c,interview:a,qid:b,fields:Viewer.interview.collectFieldData(b)};$(".continue-button").css("background-position","-298px -47px"),$(this).prepend('<span class="loading"></span>'),g=!1,d.emit("question",e)}}),$("#ltf-login").live("submit",function(a){$("#ltf-loader").css("display","inline-block"),a.preventDefault();var b=$(this).serialize();return $.ajax({type:"POST",url:BASE_URL+"/interviews/ltf_login?d="+(new Date).getTime(),data:b,dataType:"json",cache:!1,success:function(a){if($("#ltf-loader").hide(),a.error)$("#sf-g-error").html(a.msg).show();else if($("#login-container").hide(),$("#sf-g-error").hide(),$("#ltf-login").find("input:text, input:password").val(""),"open"===j){var b=Viewer.socket.getSocket(),d=$("#interview-id").html(),e={id:c,interview:d};b.emit("open_saves",e)}else $("#note-container").show()},error:function(a,b){alert(b)}}),!1}),$("#ltf-register").live("submit",function(a){$("#ltf-r-loader").css("display","inline-block"),a.preventDefault();var b=$(this).serialize();return $.ajax({type:"POST",url:BASE_URL+"/interviews/ltf_register?d="+(new Date).getTime(),data:b,dataType:"json",cache:!1,success:function(a){if($("#ltf-r-loader").hide(),a.error)$("#sf-h-error").html(a.msg).show();else if($("#login-container").hide(),$("#sf-h-error").hide(),$("#ltf-register").find("input:text, input:password").val(""),"open"===j){var b=Viewer.socket.getSocket(),d=$("#interview-id").html(),e={id:c,interview:d};b.emit("open_saves",e)}else $("#note-container").show()},error:function(a,b){alert(b)}}),!1}),$("#vfh-save").live("click",function(){if(b){var a=Viewer.socket.getSocket(),e=$("#interview-id").html(),f={id:c,qid:d,note:$.trim($("textarea[name=t-d-note]").val()),interview:e};a.emit("save_progress",f),b=!1}}),$("#finish-interview").live("click",function(){if(e){var a=$("#interview-id").html(),d=$(this).html(),f=Viewer.socket.getSocket(),g={id:c,interview:a,qid:d,fields:Viewer.interview.collectFieldData(d)};$(".finish-button").css("background-position","-432px -47px"),$(this).prepend('<span class="loading"></span>'),e=!1,b=!1,f.emit("finish",g)}}),$("#exit-interview").live("click",function(){window.location.replace(BASE_URL)}),$("#complete-interview").live("click",function(){if(f){var a=$("#interview-id").html(),b=Viewer.socket.getSocket(),d={id:c,interview:a,email:$.trim($("input[name=q-final]").val())};$(".send-button").css("background-position","-566px -47px"),$(this).prepend('<span class="loading"></span>'),f=!1,b.emit("send",d)}}),$("#progress").focus(function(){var a=document.getElementById("progress");a.options&&a.options[a.selectedIndex]&&(i=a.options[a.selectedIndex].value)}).change(function(){var b=document.getElementById("progress");if(b.options&&b.options[b.selectedIndex]){var d=b.options[b.selectedIndex].value,e=Viewer.socket.getSocket(),f=$("#interview-id").html(),g={id:c,interview:f,backid:d,previd:i};e.emit("back",g),a=!1}}),$(".id-field").live("click",function(){var a=this.id.split(":"),b=a[0],c=$("#"+b+"-var-container");c.hasClass("var-error")&&c.removeClass("var-error")}),$(".id-cb").live("click",function(){var a=this.id.split("-")[0];$("#"+a+"-nota").is(":checked")&&$("#"+a+"-nota").attr("checked",!1)}),$("input[id$='-nota']").live("click",function(){var a=this.id.split("-")[0];$(".id-cb[name='"+a+"']").each(function(){$(this).is(":checked")&&$(this).attr("checked",!1)}),$(this).attr("checked",!0)}),$("#header .scale ul li").click(function(){var a=$(this).attr("class");"small"===a?$("#main").css("font-size","1.0em"):"medium"===a?$("#main").css("font-size","1.5em"):"large"===a&&$("#main").css("font-size","2.0em")}),$(".learnmore-button").live("click",function(){$("#lmt").is(":visible")?$(this).css("background-position","-700px -7px"):$(this).css("background-position","-700px -56px"),$("#lmt").slideToggle("fast")}),$(".prompt a, .helpbox a, .learnmore a").live("click",function(a){var b=$(this).attr("href");return window.open(b),a.preventDefault(),!1})};return{init:function(){Viewer.socket.init(),i()},collectFieldData:function(a){var b=[];return $(".id-field").each(function(){var c,d=this.id.split(":"),e=d[0],f=d[1];switch(f){case"text":c=$.trim($("input[name="+e+"]").val());break;case"textarea":c=$.trim($("textarea[name="+e+"]").val());break;case"number":c=$.trim($("input[name="+e+"]").val());break;case"radio":c=$.trim($("input[name="+e+"]:checked").val());break;case"date":c=$.trim($("#"+e+"_picker").datepicker().val());break;case"checkbox":c=[],$(".id-test").each(function(){$(this).is(":checked")&&c.push($.trim($(this).val()))});break;case"text_dropdown":c=$("select[name="+e+"]").val();break;case"number_dropdown":c=$("select[name="+e+"]").val()}b.push({qid:a,name:e,section:"field",type:f,answer:c})}),b},question:function(b){$(".help-tooltip, .youtube-popout").each(function(){$(this).css("position","static")}),$(".question").fadeOut("fast",function(){$(this).empty().html(b.content),$(this).fadeIn("fast",function(){$(".help-tooltip, .youtube-popout").each(function(){$(this).css("position","relative")})}),b.date_pickers&&Viewer.interview.datePicker(b.date_pickers),a=!0})},progress:function(a){$("#progress").html(a)},fraction:function(a){$("#fraction").html(a)},saved:function(){b=!0},datePicker:function(a){var b;if(a)for(var c=0;c<a.length;c+=1){b=$("#"+a[c].name+"_picker"),b.datepicker(),b.datepicker("option","changeMonth",!0),b.datepicker("option","changeYear",!0),b.datepicker("option","yearRange","1900:2100"),a[c].format&&b.datepicker("option","dateFormat",a[c].format);for(var d in a[c].validation)a[c].validation.hasOwnProperty(d)&&("min_date"===d?b.datepicker("option","minDate",a[c].validation[d]):"max_date"===d&&("TODAY"===a[c].validation[d].toUpperCase()?b.datepicker("option","maxDate","0"):b.datepicker("option","maxDate",a[c].validation[d])));a[c].def&&("TODAY"===a[c].def.toUpperCase()?b.datepicker("option","defaultDate",null):b.datepicker("option","defaultDate",a[c].def)),null!==a[c].set&&b.datepicker("setDate",a[c].set),$(".ui-datepicker").addClass("notranslate")}},setContinueGate:function(a){g=a},setPartialGate:function(a){h=a},setFinishGate:function(a){e=a},setCompleteGate:function(a){f=a},setInterviewID:function(a){c=a},setCurrentQID:function(a){d=a}}}();